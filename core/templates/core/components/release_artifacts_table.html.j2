{% comment %}
Release Artifacts Table Component - follows the same pattern as items_table.html.j2
Context variables:
- release: Release object with prefetched artifacts
- product_id: Product ID
- has_crud_permissions: Boolean for CRUD permissions
- is_latest_release: Boolean indicating if this is the latest release
- table_title: Title for the table (default: "Artifacts")
{% endcomment %}
{% load static %}
<!-- Standard Card Container -->
<div class="card shadow-sm border-0 standard-card">
    <div class="card-header bg-white border-bottom">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h5 class="card-title mb-0 fw-semibold">{{ table_title|default:"Artifacts" }}</h5>
                <p class="card-subtitle text-muted mb-0 mt-1 small">Software components and documents included in this release</p>
            </div>
            <div class="d-flex align-items-center gap-2">
                {% if can_modify_artifacts %}
                    <button class="btn btn-sm btn-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#addArtifactModal">
                        <i class="fas fa-plus me-1"></i>Add Artifact
                    </button>
                {% elif is_latest_release and has_crud_permissions %}
                    <div class="alert alert-info mb-0 py-2 px-3 small">
                        <i class="fas fa-info-circle me-1"></i>
                        The "Latest" release is automatically managed and cannot be modified manually.
                    </div>
                {% endif %}
                <button class="btn btn-sm btn-outline-secondary border-0"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#artifacts-table-content"
                        aria-expanded="true"
                        title="Toggle table visibility">
                    <i class="fas fa-chevron-up transition-transform"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="collapse show" id="artifacts-table-content">
        <div class="card-body p-0">
            {% if not release.artifacts.exists %}
                <!-- Empty state -->
                <div class="text-center text-muted py-5">
                    <i class="fas fa-puzzle-piece fa-3x mb-3 opacity-25"></i>
                    <h6 class="text-muted">No artifacts yet</h6>
                    <p class="text-muted mb-3">Add artifacts to this release to get started</p>
                    {% if can_modify_artifacts %}
                        <button class="btn btn-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#addArtifactModal">
                            <i class="fas fa-plus me-2"></i>Add Artifact
                        </button>
                    {% elif is_latest_release and has_crud_permissions %}
                        <div class="text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Latest release is automatically managed
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <!-- Use standardized table -->
                {% with artifacts_list=release.artifacts.all %}
                    {% if can_modify_artifacts %}
                        {% with table_config=artifacts_table_config_with_actions %}
                            {% include "core/components/standard_table.html.j2" with items=artifacts_list table_config=table_config table_title="Artifacts" has_crud_permissions=has_crud_permissions show_add_button=can_modify_artifacts add_button_text="Add Artifact" add_modal_target="addArtifactModal" %}
                        {% endwith %}
                    {% else %}
                        {% with table_config=artifacts_table_config %}
                            {% include "core/components/standard_table.html.j2" with items=artifacts_list table_config=table_config table_title="Artifacts" has_crud_permissions=False show_add_button=False %}
                        {% endwith %}
                    {% endif %}
                {% endwith %}
            {% endif %}
        </div>
    </div>
</div>
<!-- Add Artifact Modal -->
{% if can_modify_artifacts %}
    <div class="modal fade"
         id="addArtifactModal"
         tabindex="-1"
         aria-labelledby="addArtifactModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addArtifactModalLabel">
                        <i class="fas fa-plus me-2"></i>Add Artifact to Release
                    </h5>
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Search and Filter Controls -->
                    <div class="mb-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="artifactSearch" class="form-label">Search Artifacts</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    <input type="text"
                                           class="form-control"
                                           id="artifactSearch"
                                           placeholder="Search by name, component, or format...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label for="artifactTypeFilter" class="form-label">Type</label>
                                <select class="form-select" id="artifactTypeFilter">
                                    <option value="">All Types</option>
                                    <option value="sbom">SBOMs Only</option>
                                    <option value="document">Documents Only</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="artifactComponentFilter" class="form-label">Component</label>
                                <select class="form-select" id="artifactComponentFilter">
                                    <option value="">All Components</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Artifacts Table Container -->
                    <div id="artifactsTableContainer">
                        <!-- Content will be populated by TypeScript -->
                        <div class="text-center py-4">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="ms-2">Loading available artifacts...</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button"
                            class="btn btn-primary"
                            id="addSelectedArtifacts"
                            disabled>Add Artifacts</button>
                </div>
            </div>
        </div>
    </div>
{% endif %}
<!-- Add data attribute for TypeScript initialization -->
<div data-release-id="{{ release.id }}" class="d-none"></div>
{% load django_vite %}
<!-- Release artifacts functionality handled by TypeScript modules in main.js -->
