# ADR-004: Immutable Security Artifacts

## Status

Accepted

## Date

2025-12-21

## Context

Many SBOM platforms perform backend modifications to artifacts after ingestion—adding metadata, normalizing formats, or augmenting component information. While this may seem convenient, it creates a fundamental trust problem: users must trust that the platform has not tampered with their security artifacts in unintended ways.

This becomes especially problematic when:

- **Attestations are involved**: If a platform modifies an SBOM after it has been signed, the signature becomes invalid. Alternatively, if the platform re-signs the artifact, the chain of custody is broken and users must now trust the platform's signing key.
- **Compliance audits occur**: Auditors need to verify that the SBOM distributed to customers matches what was produced during the build. Any modification creates ambiguity.
- **Forensic analysis is required**: When investigating a security incident, teams need certainty that the artifact they're examining is identical to what was originally produced.

sbomify takes a different approach as a core principle that differentiates it from other alternatives.

## Decision

**sbomify never modifies security artifacts.**

This principle applies to all artifacts ingested by sbomify, including:

- SBOMs (CycloneDX, SPDX)
- Documents (security policies, compliance reports, VEX statements, etc.)
- Attestations (Sigstore bundles, in-toto attestations)
- Signatures and verification materials

### Core Tenets

1. **Immutability**: Artifacts are stored exactly as received. The bytes that enter sbomify are the bytes that are stored and later retrieved.

2. **External Source of Truth**: The authoritative version of any artifact lives outside sbomify—in the user's CI/CD pipeline, internal signing infrastructure, or any other controlled environment they operate.

3. **No Backend Modifications**: sbomify never alters artifacts after receipt. This means no enrichment, no augmentation, no normalization, and no transformation of any kind.

4. **Attestation at Origin**: Signing and attestation happen before sbomify receives the artifact. This could be in CI/CD pipelines (e.g., using the sbomify GitHub Action), internal signing services, or offline signing ceremonies.

5. **Verifiable Distribution**: Users can always verify artifacts against the original source, eliminating the need to trust sbomify as a distribution mechanism.

### What sbomify Does Instead

sbomify provides value through **analysis** rather than modification:

- **Assessment plugins** analyze artifacts and produce separate findings (see ADR-003)
- **Vulnerability scanning** queries external databases without altering the SBOM
- **Compliance checking** evaluates against standards and produces reports
- **Attestation verification** validates signatures against trust roots

All of these operations read the artifact and produce separate output—they never modify the artifact itself.

### Caveat: Generated Artifacts

This principle applies to **ingested** artifacts. sbomify may generate **new** artifacts based on user actions or analysis, such as:

- **Aggregate SBOMs**: Combining multiple component SBOMs into a product-level SBOM
- **VEX/VDR documents**: Generating vulnerability disclosure reports based on scan results
- **Derived reports**: Creating compliance reports or summaries

These generated artifacts are clearly distinct from ingested artifacts—they are new creations by sbomify, not modifications to user-submitted content. Users should apply their own signing and attestation processes to any generated artifacts they wish to distribute with the same trust guarantees as their original artifacts.

## Practical Examples

### Example 1: CI/CD Pipeline with sbomify GitHub Action

```text
┌─────────────────────────────────────────────┐
│ CI/CD Pipeline (Source of Truth)            │
│                                             │
│  1. Generate SBOM                           │
│  2. Enrich and add organizational metadata  │
│  3. Sign/Attest SBOM                        │
│                                             │
└──────────────────┬──────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────┐
│ sbomify                                     │
│                                             │
│  • Store artifact as-is                     │
│  • Run assessment plugins (analysis only)   │
│  • Serve artifact unchanged on retrieval    │
│                                             │
└─────────────────────────────────────────────┘
```

### Example 2: Internal Signing Infrastructure

```text
┌─────────────────────────────────────────────┐
│ Internal Signing Service (Source of Truth)  │
│                                             │
│  1. Receive SBOM from build system          │
│  2. Apply organizational attestations       │
│  3. Sign with enterprise key                │
│                                             │
└──────────────────┬──────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────┐
│ sbomify                                     │
│                                             │
│  • Store artifact as-is                     │
│  • Verify attestation (read-only check)     │
│  • Serve artifact unchanged on retrieval    │
│                                             │
└─────────────────────────────────────────────┘
```

In both cases, verification can always be performed against the original source. If a customer or auditor questions the integrity of an artifact, they can compare it byte-for-byte with what was produced at origin.

## Relationship to Other ADRs

This principle is foundational to the design decisions in ADR-003 (Plugin-based Assessments):

- The **AssessmentPlugin framework** produces `AssessmentRun` records that are stored separately from the SBOM—the plugin reads the artifact but never writes to it.
- **Attestation plugins** verify integrity and provenance without modifying the artifact. They confirm that signatures are valid against configured trust roots.
- The `sbom_path` passed to plugins is read-only; plugins have no mechanism to alter the stored artifact.

## Consequences

### Positive

- **Zero-trust distribution**: Users never need to trust sbomify with the integrity of their artifacts. They can always verify against the original source.
- **Forensic integrity**: Artifacts match their origin exactly, enabling reliable incident investigation.
- **Attestation validity**: Signatures remain valid because the signed content is never modified.
- **Simplified compliance**: Clear chain of custody with no ambiguity about what was modified and when.
- **Reproducibility**: The same artifact retrieved today will be byte-identical to what was uploaded months ago.

### Negative / Tradeoffs

- **User responsibility**: Users must handle any modifications (enrichment, normalization, metadata addition) in their own pipelines before submission to sbomify.
- **No convenience features**: sbomify cannot auto-add missing metadata, fix formatting issues, or "improve" incomplete SBOMs.
- **Potential for incomplete artifacts**: If a user uploads a poorly-formed SBOM, sbomify will store it as-is (though assessment plugins will flag the issues).

## Alternatives Considered

1. **Backend modification with full transparency**: Modify artifacts but maintain complete audit logs of changes. **Rejected** because it still breaks signatures, complicates chain of custody, and requires users to trust the modification logic.

2. **Optional modification with versioning**: Store the original and allow users to opt-in to enrichment, storing modified versions separately. **Rejected** because it still alters artifacts (even if optional), creates confusion about which version is authoritative, and adds complexity without clear benefit.

3. **Modification with re-signing**: Modify artifacts and re-sign with sbomify's key. **Rejected** because it requires users to trust sbomify's key, breaks the original attestation chain, and defeats the purpose of origin-based signing.

## References

- [ADR-003: Plugin-based Assessments for SBOM Uploads](ADR-003.md) - Assessment framework that implements this principle
- [Sigstore](https://www.sigstore.dev/) - Keyless signing for software artifacts
- [in-toto](https://in-toto.io/) - Framework for software supply chain integrity
- [SLSA](https://slsa.dev/) - Supply chain Levels for Software Artifacts
