<template x-teleport="body">
    <div x-show="{{ modal_id }}"
         x-ref="modalOverlay"
         x-init="window.initDeleteModal && window.initDeleteModal('{{ modal_id }}', $el)"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"
         tabindex="-1"
         role="dialog"
         aria-modal="true"
         aria-labelledby="delete-modal-title-{{ modal_id }}"
         @click="{{ modal_id }} = false"
         @keydown.escape.window="{{ modal_id }} = false"
         @keydown.tab.prevent="window.handleTabKey($event)"
         x-transition:enter="transition ease-out duration-150"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         style="display: none">
        <div class="bg-card rounded-xl shadow-xl w-full max-w-md overflow-hidden"
             @click.stop>
            {# Modal Header #}
            <div class="px-6 pt-6 pb-4 text-center">
                <div class="w-14 h-14 mx-auto mb-4 rounded-full bg-danger/10 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-danger text-2xl"></i>
                </div>
                <h3 id="delete-modal-title-{{ modal_id }}"
                    class="text-xl font-semibold text-text m-0">{{ title|default:'Confirm Delete' }}</h3>
                <button type="button"
                        class="absolute top-4 right-4 w-8 h-8 rounded-lg text-text-muted hover:bg-border/30 transition-colors flex items-center justify-center"
                        @click="{{ modal_id }} = false"
                        x-ref="closeButton"
                        aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            {# Modal Body #}
            <div class="px-6 pb-4 text-center">
                <p class="text-text mb-3">
                    {{ message|default:'Are you sure you want to delete' }}
                    {% if item_name_expression %}
                        <span class="font-semibold text-danger" x-text="{{ item_name_expression }}"></span>?
                    {% elif item_name %}
                        <span class="font-semibold text-danger">{{ item_name }}</span>?
                    {% endif %}
                </p>
                <p class="text-text-muted text-sm m-0">
                    {{ warning_message|default:'This action cannot be undone and will permanently remove the item from the system.' }}
                </p>
            </div>
            {# Modal Footer #}
            <div class="px-6 py-4 bg-background/50 border-t border-border flex justify-end gap-3">
                <button type="button"
                        class="tw-btn-secondary"
                        @click="{{ modal_id }} = false"
                        x-ref="cancelButton">{{ cancel_text|default:'Cancel' }}</button>
                {# djlint:off #}
            <button type="button"
                    class="px-4 py-2 bg-danger text-white rounded-lg font-medium hover:bg-danger/90 transition-colors flex items-center gap-2"
                    x-ref="deleteButton"
                    {% if hx_url %}
                    x-data="window.getDeleteModalData({
                        modalId: '{{ modal_id }}',
                        hxUrl: '{{ hx_url }}',
                        hxMethod: '{{ hx_method|default:'DELETE'|upper }}',
                        successMessage: '{{ success_message|default:'Deleted successfully!' }}',
                        csrfToken: '{{ csrf_token }}',
                        redirectUrl: '{{ redirect_url|default:'' }}',
                        refreshEvent: '{{ refresh_event|default:'' }}'
                    })"
                    @click="handleDelete()"
                    :disabled="isLoading"
                    :class="{ 'opacity-75 cursor-not-allowed': isLoading }"
            {% elif confirm_callback %}
                @click="{{ confirm_callback }}"
            {% endif %}
            >
            {% if hx_url %}
            <i class="fas fa-spinner fa-spin" x-show="isLoading" style="display: none;"></i>
            <i class="fas fa-trash" x-show="!isLoading"></i>
            <span x-text="isLoading ? 'Deleting...' : '{{ confirm_text|default:'Delete' }}'"></span>
            {% else %}
            <i class="fas fa-trash"></i>
            {{ confirm_text|default:'Delete' }}
            {% endif %}
            </button>
                {# djlint:on #}
            </div>
        </div>
    </div>
</template>
