{% extends "core/public_base.htmx.j2" %}
{% load breadcrumb_tags %}
{% load django_vite %}
{% load static %}
{% block title %}{{ component.name }} - {{ component.component_type_display }}{% endblock %}
{% block meta_description %}
    {{ component.name }} - {{ component.component_type_display }} component.
    {% block meta_description_suffix %}{% endblock %}
{% endblock %}
{% block og_title %}{{ component.name }} - {{ component.component_type_display }}{% endblock %}
{% block og_description %}
    {{ component.name }} - {{ component.component_type_display }} component. View and download security artifacts.
{% endblock %}
{% block breadcrumb %}
    {% breadcrumb component 'component' %}
{% endblock %}
{% block content %}
    <div class="public-item-header">
        {% if back_url or fallback_url %}
            <a href="{{ fallback_url|default:back_url }}"
               class="back-link"
               onclick="if (window.history.length > 1) { window.history.back(); return false; }">
                <i class="fas fa-arrow-left"></i>
                Back
            </a>
        {% endif %}
        <h1 class="public-item-title">
            <span class="public-item-title-icon icon-component">
                <i class="fas fa-cube"></i>
            </span>
            {{ component.name }}
        </h1>
        <div class="public-item-badges">
            <span class="public-badge badge-type">
                <i class="fas fa-tag"></i>
                {{ component.component_type_display }}
            </span>
            {% if component.is_global %}
                <span class="public-badge badge-workspace">
                    <i class="fas fa-building"></i>
                    Workspace-wide
                </span>
            {% endif %}
            {% if component.visibility == 'gated' %}
                <span class="public-badge badge-gated">
                    <i class="fas fa-lock"></i>
                    Gated Access
                </span>
            {% endif %}
            {% for assessment in passing_assessments %}
                {% include 'plugins/components/public_assessment_badge.html.j2' with assessment=assessment %}
            {% endfor %}
        </div>
        {% if component.visibility == 'gated' %}
            <div class="gated-access-notice mt-3">
                {% if user_has_gated_access %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Access Granted:</strong> You have access to download from this component.
                    </div>
                {% elif pending_request_needs_nda %}
                    <div class="alert alert-warning d-flex align-items-center justify-content-between flex-wrap">
                        <span class="d-flex align-items-center">
                            <i class="fas fa-file-signature me-2"></i>
                            <strong>NDA Required:</strong> Please sign the NDA to complete your access request.
                        </span>
                        <a href="{% url 'documents:sign_nda' team.key pending_request_id %}"
                           class="btn btn-sm btn-primary ms-auto">
                            <i class="fas fa-signature me-1"></i>Sign NDA
                        </a>
                    </div>
                {% elif access_request_status == 'pending' %}
                    <div class="alert alert-info">
                        <i class="fas fa-clock me-2"></i>
                        <strong>Access Request Pending:</strong> Your request for access is being reviewed.
                    </div>
                {% elif access_request_status == 'rejected' %}
                    <div class="alert alert-warning d-flex align-items-center justify-content-between flex-wrap">
                        <span class="d-flex align-items-center">
                            <i class="fas fa-times-circle me-2"></i>
                            <strong>Access Request Rejected:</strong> Your request was not approved. You can request access again.
                        </span>
                        <a href="{% url 'documents:request_access' team.key %}"
                           class="btn btn-sm btn-primary ms-auto">Request Access Again</a>
                    </div>
                {% else %}
                    <div class="alert alert-warning d-flex align-items-center justify-content-between flex-wrap">
                        <span class="d-flex align-items-center">
                            <i class="fas fa-lock me-2"></i>
                            <strong>Gated Component:</strong> This component requires approval to download.
                        </span>
                        <a href="{% url 'documents:request_access' team.key %}"
                           class="btn btn-sm btn-primary ms-auto">
                            <i class="fas fa-key me-1"></i>Request Access
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <div class="public-section">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">
                    {% block table_icon %}<i class="fas fa-list"></i>{% endblock %}
                    {{ component.component_type_display }} Items
                </h4>
            </div>
            <div class="card-body">
                {% block table_section %}{% endblock %}
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    {% vite_asset 'sbomify/apps/core/js/main.ts' %}
    {% block scripts_additional %}{% endblock %}
{% endblock %}
