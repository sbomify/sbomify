{% extends "core/public_base.htmx.j2" %}
{% load breadcrumb_tags %}
{% load django_vite %}
{% load static %}
{% block title %}{{ component.name }} - {{ component.component_type_display }}{% endblock %}
{% block meta_description %}
    {{ component.name }} - {{ component.component_type_display }} component.
    {% block meta_description_suffix %}{% endblock %}
{% endblock %}
{% block og_title %}{{ component.name }} - {{ component.component_type_display }}{% endblock %}
{% block og_description %}
    {{ component.name }} - {{ component.component_type_display }} component. View and download security artifacts.
{% endblock %}
{% block breadcrumb %}
    {% breadcrumb component 'component' %}
{% endblock %}
{% block content %}
    <div class="public-item-header">
        {% if back_url or fallback_url %}
            <a href="{{ fallback_url|default:back_url }}"
               class="inline-flex items-center gap-2 text-text-muted hover:text-text mb-4 no-underline"
               onclick="if (window.history.length > 1) { window.history.back(); return false; }">
                <i class="fas fa-arrow-left" aria-hidden="true"></i>
                Back
            </a>
        {% endif %}
        <h1 class="text-3xl font-bold text-text flex items-center gap-4 mb-3">
            <span class="w-12 h-12 rounded-xl bg-info/10 flex items-center justify-center text-info">
                <i class="fas fa-cube"></i>
            </span>
            {{ component.name }}
        </h1>
        <div class="flex flex-wrap gap-2 mb-6">
            <span class="px-3 py-1.5 text-sm font-medium rounded-full bg-warning/10 text-warning flex items-center gap-2">
                <i class="fas fa-tag"></i>
                {{ component.component_type_display }}
            </span>
            {% if component.is_global %}
                <span class="px-3 py-1.5 text-sm font-medium rounded-full bg-primary/10 text-primary flex items-center gap-2">
                    <i class="fas fa-building"></i>
                    Workspace-wide
                </span>
            {% endif %}
            {% if component.visibility == 'gated' %}
                <span class="px-3 py-1.5 text-sm font-medium rounded-full bg-border/50 text-text flex items-center gap-2">
                    <i class="fas fa-lock"></i>
                    Gated Access
                </span>
            {% endif %}
            {% for assessment in passing_assessments %}
                {% include 'plugins/components/public_assessment_badge.html.j2' with assessment=assessment %}
            {% endfor %}
        </div>
        {% if component.visibility == 'gated' %}
            <div class="mt-4"
                 {% if request.user.is_authenticated %} x-data="{ currentUserId: '{{ request.user.id }}' }" @ws:message.window="if ($event.detail.type === 'access_request_updated' && $event.detail.user_id === currentUserId) { window.location.reload(); }" {% endif %}>
                {% if needs_nda_signing %}
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 p-4 rounded-lg bg-warning/10 border border-warning/30">
                        <span class="flex items-center gap-2 text-text">
                            <i class="fas fa-file-signature text-warning"></i>
                            <span>
                                <strong>NDA Required:</strong>
                                {% if is_new_nda_version %}
                                    New version of the NDA is available. Please sign the updated NDA to access this component.
                                {% else %}
                                    Please sign the NDA to access this component.
                                {% endif %}
                            </span>
                        </span>
                        <a href="{% url 'documents:sign_nda' team.key nda_access_request_id %}"
                           class="tw-btn-primary text-sm whitespace-nowrap">
                            <i class="fas fa-signature mr-1"></i> Sign NDA
                        </a>
                    </div>
                {% elif user_has_gated_access %}
                    <div class="flex items-center gap-2 p-4 rounded-lg bg-success/10 border border-success/30 text-text">
                        <i class="fas fa-check-circle text-success"></i>
                        <span><strong>Access Granted:</strong> You have access to download from this component.</span>
                    </div>
                {% elif pending_request_needs_nda %}
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 p-4 rounded-lg bg-warning/10 border border-warning/30">
                        <span class="flex items-center gap-2 text-text">
                            <i class="fas fa-file-signature text-warning"></i>
                            <span><strong>NDA Required:</strong> Please sign the NDA to complete your access request.</span>
                        </span>
                        <a href="{% url 'documents:sign_nda' team.key pending_request_id %}"
                           class="tw-btn-primary text-sm whitespace-nowrap">
                            <i class="fas fa-signature mr-1"></i> Sign NDA
                        </a>
                    </div>
                {% elif access_request_status == 'pending' %}
                    <div class="flex items-center gap-2 p-4 rounded-lg bg-info/10 border border-info/30 text-text">
                        <i class="fas fa-clock text-info"></i>
                        <span><strong>Access Request Pending:</strong> Your request for access is being reviewed.</span>
                    </div>
                {% elif access_request_status == 'rejected' %}
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 p-4 rounded-lg bg-warning/10 border border-warning/30">
                        <span class="flex items-center gap-2 text-text">
                            <i class="fas fa-times-circle text-warning"></i>
                            <span><strong>Access Request Rejected:</strong> Your request was not approved. You can request access again.</span>
                        </span>
                        <a href="{% url 'documents:request_access' team.key %}"
                           class="tw-btn-primary text-sm whitespace-nowrap">Request Access Again</a>
                    </div>
                {% else %}
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 p-4 rounded-lg bg-warning/10 border border-warning/30">
                        <span class="flex items-center gap-2 text-text">
                            <i class="fas fa-lock text-warning"></i>
                            <span><strong>Gated Component:</strong> This component requires approval to download.</span>
                        </span>
                        <a href="{% url 'documents:request_access' team.key %}"
                           class="tw-btn-primary text-sm whitespace-nowrap">
                            <i class="fas fa-key mr-1"></i> Request Access
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <div class="public-section">
        <div class="tw-card">
            <div class="px-6 py-4 border-b border-border">
                <h4 class="text-lg font-semibold text-text flex items-center gap-2 m-0">
                    {% block table_icon %}<i class="fas fa-list text-primary"></i>{% endblock %}
                    {{ component.component_type_display }} Items
                </h4>
            </div>
            <div class="p-6">
                {% block table_section %}{% endblock %}
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    {% vite_asset 'sbomify/apps/core/js/main.ts' %}
    {% block scripts_additional %}{% endblock %}
{% endblock %}
