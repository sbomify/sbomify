{% comment %}
  Form Field Wrapper Partial

  Usage with Django form field:
  {% include "core/components/_form_field.html.j2" with
      field=form.email
      help_text="Enter your work email address"
  %}

  Parameters:
  - field: Django form field object (required)
  - help_text: Optional help text (overrides field.help_text)
  - label_class: Additional classes for label
  - input_class: Additional classes for input (added to tw-form-input)
  - required: Force required display (uses field.required by default)
  - horizontal: Set to true for horizontal form layout
  - label_cols: Column width for label in horizontal layout (default: 3)
  - input_cols: Column width for input in horizontal layout (default: 9)
{% endcomment %}
{% load widget_tweaks %}
{% if horizontal %}
    <div class="grid grid-cols-12 gap-4 mb-4 items-start">
        {# Map column widths to static Tailwind classes (dynamic class names are not scanned by Tailwind) #}
        {% if label_cols == 4 %}
            {% set label_col_class = "col-span-4" %}
        {% elif label_cols == 2 %}
            {% set label_col_class = "col-span-2" %}
        {% else %}
            {% set label_col_class = "col-span-3" %}
        {% endif %}
        {% if input_cols == 8 %}
            {% set input_col_class = "col-span-8" %}
        {% elif input_cols == 10 %}
            {% set input_col_class = "col-span-10" %}
        {% else %}
            {% set input_col_class = "col-span-9" %}
        {% endif %}
        <label for="{{ field.id_for_label }}"
               class="{{ label_col_class }} text-sm font-medium text-text pt-2 {{ label_class }}">
            {{ field.label }}
            {% if required|default:field.required %}<span class="text-danger" aria-hidden="true">*</span>{% endif %}
        </label>
        <div class="{{ input_col_class }}">
            {{ field|add_class:"tw-form-input"|add_class:input_class }}
            {% if help_text or field.help_text %}
                <p id="{{ field.id_for_label }}-help"
                   class="text-text-muted text-xs mt-1">{{ help_text|default:field.help_text }}</p>
            {% endif %}
            {% if field.errors %}
                <div class="text-danger text-sm mt-1" role="alert">
                    {% for error in field.errors %}
                        {{ error }}
                        {% if not forloop.last %}<br>{% endif %}
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% else %}
    <div class="mb-4">
        <label for="{{ field.id_for_label }}"
               class="block text-sm font-medium text-text mb-1 {{ label_class }}">
            {{ field.label }}
            {% if required|default:field.required %}<span class="text-danger" aria-hidden="true">*</span>{% endif %}
        </label>
        {% if field.field.widget.input_type == 'select' %}
            {{ field|add_class:"tw-form-input"|add_class:input_class }}
        {% elif field.field.widget.input_type == 'checkbox' %}
            <div class="flex items-center gap-2">
                {{ field|add_class:"w-4 h-4 rounded border-border text-primary focus:ring-primary"|add_class:input_class }}
            </div>
        {% else %}
            {{ field|add_class:"tw-form-input"|add_class:input_class }}
        {% endif %}
        {% if help_text or field.help_text %}
            <p id="{{ field.id_for_label }}-help"
               class="text-text-muted text-xs mt-1">{{ help_text|default:field.help_text }}</p>
        {% endif %}
        {% if field.errors %}
            <div class="text-danger text-sm mt-1" role="alert">
                {% for error in field.errors %}
                    {{ error }}
                    {% if not forloop.last %}<br>{% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endif %}
