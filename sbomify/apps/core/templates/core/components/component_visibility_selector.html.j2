{% load static %}
<link rel="stylesheet"
      href="{% static 'css/components/public-status-toggle.css' %}">
<div x-data="componentVisibilitySelector({ itemId: '{{ component.id|escapejs }}', publicUrl: '{{ component_public_url|escapejs }}', currentVisibility: '{{ component.visibility|escapejs }}', gatedVisibilityAllowed: {{ gated_visibility_allowed|yesno:'true,false' }} })"
     class="inline-flex items-center gap-3 flex-wrap px-3 py-2 bg-background border border-border rounded-lg">
    <div class="relative" :class="{ 'opacity-50': isLoading }">
        <form hx-post="{% url 'core:toggle_public_status' 'component' component.id %}"
              hx-trigger="change from:select"
              hx-swap="none"
              @htmx:before-request="beforeRequestHandler()"
              @htmx:after-request="afterRequestHandler($event)">
            {% csrf_token %}
            <select class="px-3 py-1.5 text-sm bg-surface border border-border rounded-lg text-text focus:outline-none focus:ring-2 focus:ring-primary/50 pr-8"
                    name="visibility"
                    x-model="visibility"
                    :disabled="isLoading">
                <option value="public">Public</option>
                <option value="private">Private</option>
                <option value="gated" :disabled="!gatedVisibilityAllowed">
                    Gated
                    {% if not gated_visibility_allowed %}(Requires Business/Enterprise plan){% endif %}
                </option>
            </select>
        </form>
    </div>
    <div x-show="isLoading" x-cloak class="text-text-muted">
        <i class="fas fa-spinner fa-spin"></i>
    </div>
    <span class="text-text-muted cursor-help"
          x-tooltip="'Control who can access this component'">
        <i class="fas fa-info-circle"></i>
    </span>
    <button x-show="visibility === 'public' || visibility === 'gated'"
            x-cloak
            type="button"
            class="copy-url-btn"
            x-tooltip="'Copy public URL'"
            @click="copyToClipboard()">
        <i class="fas fa-copy"></i>
        <span class="copy-text">Copy URL</span>
    </button>
    <button x-show="visibility === 'public' || visibility === 'gated'"
            x-cloak
            type="button"
            class="copy-badge-btn"
            x-tooltip="'Copy badge markdown for README'"
            @click="copyBadgeToClipboard()">
        <i class="fas fa-certificate"></i>
        <span class="copy-text">Copy Badge</span>
    </button>
</div>
