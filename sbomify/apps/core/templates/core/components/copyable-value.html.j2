{% load static %}
<link rel="stylesheet"
      href="{% static 'css/components/copyable-value.css' %}">
<span class="copyable-value meta-id"
      x-data="copyableValue({ value: '{{ value|escapejs }}', hideValue: {{ hide_value|yesno:"true,false" }}, copyFrom: '{{ copy_from|escapejs }}', title: '{{ title|escapejs }}' })"
      @click="copyToClipboard()"
      :title="title">
    <span x-show="!hideValue && value" x-text="value"></span>
    <span class="ps-2">
        <svg viewBox="0 0 24 24"
             width="24"
             height="24"
             stroke="currentColor"
             stroke-width="2"
             fill="none"
             stroke-linecap="round"
             stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
    </span>
</span>
<script>
function copyableValue({ value, hideValue, copyFrom, title }) {
    return {
        value,
        hideValue,
        copyFrom,
        title,

        copyToClipboard() {
            let valueToCopy = this.copyFrom ? document.getElementById(this.copyFrom).innerText : this.value;

            navigator.clipboard.writeText(valueToCopy).then(() => {
                this.$dispatch('messages', {
                    value: [{
                        type: 'success',
                        message: 'Copied to clipboard'
                    }]
                });
            }).catch(err => {
                console.error('Failed to copy:', err);
                this.$dispatch('messages', {
                    value: [{
                        type: 'error',
                        message: 'Failed to copy to clipboard'
                    }]
                });
            });
        }
    };
}
</script>
