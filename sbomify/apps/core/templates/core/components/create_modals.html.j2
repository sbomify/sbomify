{# Create Modals - Alpine.js + Tailwind Implementation #}
{# Shared modal state - listens for custom events from header #}
<div x-data="{ productModal: false, projectModal: false, componentModal: false, closeAll() { this.productModal = false; this.projectModal = false; this.componentModal = false; } }"
     @open-product-modal.window="productModal = true"
     @open-project-modal.window="projectModal = true"
     @open-component-modal.window="componentModal = true"
     @keydown.escape.window="closeAll()">
    {# New Product Modal #}
    <div x-show="productModal"
         x-cloak
         class="fixed inset-0 z-[1055] overflow-y-auto"
         role="dialog"
         aria-modal="true"
         aria-labelledby="newProductModalLabel">
        {# Backdrop #}
        <div x-show="productModal"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/60 backdrop-blur-sm"
             @click="productModal = false"></div>
        {# Modal Content #}
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div x-show="productModal"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.stop
                 class="relative w-full max-w-md bg-surface border border-border rounded-xl shadow-2xl">
                <div class="flex items-center justify-between px-6 py-4 border-b border-border">
                    <h4 id="newProductModalLabel" class="text-lg font-semibold text-text">Add Product</h4>
                    <button type="button"
                            @click="productModal = false"
                            class="p-2 rounded-lg text-text-muted hover:text-text hover:bg-border/50 transition-colors"
                            aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="newProductForm"
                          method="post"
                          action="{% url 'core:products_dashboard' %}">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label class="tw-form-label" for="newProductName">
                                Name <span class="text-danger">*</span>
                            </label>
                            <input id="newProductName"
                                   name="name"
                                   type="text"
                                   class="tw-form-input"
                                   required />
                        </div>
                        <div class="mb-6">
                            <label class="tw-form-label" for="newProductDescription">Description (Optional)</label>
                            <textarea id="newProductDescription"
                                      name="description"
                                      class="tw-form-input"
                                      rows="3"
                                      placeholder="Describe your product..."></textarea>
                        </div>
                        <div class="flex justify-end gap-3">
                            <button type="button" class="tw-btn-secondary" @click="productModal = false">Cancel</button>
                            <button type="submit" class="tw-btn-primary">Create Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {# New Project Modal #}
    <div x-show="projectModal"
         x-cloak
         class="fixed inset-0 z-[1055] overflow-y-auto"
         role="dialog"
         aria-modal="true"
         aria-labelledby="newProjectModalLabel">
        {# Backdrop #}
        <div x-show="projectModal"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/60 backdrop-blur-sm"
             @click="projectModal = false"></div>
        {# Modal Content #}
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div x-show="projectModal"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.stop
                 class="relative w-full max-w-md bg-surface border border-border rounded-xl shadow-2xl">
                <div class="flex items-center justify-between px-6 py-4 border-b border-border">
                    <h4 id="newProjectModalLabel" class="text-lg font-semibold text-text">Add Project</h4>
                    <button type="button"
                            @click="projectModal = false"
                            class="p-2 rounded-lg text-text-muted hover:text-text hover:bg-border/50 transition-colors"
                            aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="newProjectForm"
                          method="post"
                          action="{% url 'core:projects_dashboard' %}">
                        {% csrf_token %}
                        <div class="mb-6">
                            <label class="tw-form-label" for="newProjectName">
                                Name <span class="text-danger">*</span>
                            </label>
                            <input id="newProjectName"
                                   name="name"
                                   type="text"
                                   class="tw-form-input"
                                   required />
                        </div>
                        <div class="flex justify-end gap-3">
                            <button type="button" class="tw-btn-secondary" @click="projectModal = false">Cancel</button>
                            <button type="submit" class="tw-btn-primary">Create Project</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {# New Component Modal #}
    <div x-show="componentModal"
         x-cloak
         class="fixed inset-0 z-[1055] overflow-y-auto"
         role="dialog"
         aria-modal="true"
         aria-labelledby="newComponentModalLabel">
        {# Backdrop #}
        <div x-show="componentModal"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/60 backdrop-blur-sm"
             @click="componentModal = false"></div>
        {# Modal Content #}
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div x-show="componentModal"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.stop
                 class="relative w-full max-w-md bg-surface border border-border rounded-xl shadow-2xl"
                 x-data="{ componentType: 'sbom' }">
                <div class="flex items-center justify-between px-6 py-4 border-b border-border">
                    <h4 id="newComponentModalLabel" class="text-lg font-semibold text-text">Add Component</h4>
                    <button type="button"
                            @click="componentModal = false"
                            class="p-2 rounded-lg text-text-muted hover:text-text hover:bg-border/50 transition-colors"
                            aria-label="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="newComponentForm"
                          method="post"
                          action="{% url 'core:components_dashboard' %}">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label class="tw-form-label" for="newComponentName">
                                Name <span class="text-danger">*</span>
                            </label>
                            <input id="newComponentName"
                                   name="name"
                                   type="text"
                                   class="tw-form-input"
                                   required />
                        </div>
                        <div class="mb-4">
                            <label class="tw-form-label" for="newComponentType">
                                Type <span class="text-danger">*</span>
                            </label>
                            <select id="newComponentType"
                                    name="component_type"
                                    class="tw-form-select"
                                    required
                                    x-model="componentType">
                                <option value="sbom">SBOM</option>
                                <option value="document">Document</option>
                            </select>
                            <p class="text-xs text-text-muted mt-1">Choose the type of component you're creating</p>
                        </div>
                        <div class="mb-6" x-show="componentType === 'document'" x-cloak>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input id="newComponentIsGlobal"
                                       name="is_global"
                                       type="checkbox"
                                       class="w-4 h-4 rounded border-border bg-surface text-primary focus:ring-primary">
                                <span class="text-sm font-medium text-text">Workspace-wide component (documents only)</span>
                            </label>
                            <p class="text-xs text-text-muted mt-1 ml-7">
                                Global components live at the workspace level and are not tied to a specific project. Use for documents and attestations.
                            </p>
                        </div>
                        <div class="flex justify-end gap-3">
                            <button type="button"
                                    class="tw-btn-secondary"
                                    @click="componentModal = false">Cancel</button>
                            <button type="submit" class="tw-btn-primary">Create Component</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
