{% load static %}
<div class="modal fade"
     id="itemSelectModal"
     tabindex="-1"
     aria-labelledby="itemSelectModalLabel"
     aria-hidden="true"
     x-data="itemSelectModal({ itemType: 'component', excludeItems: ['{{ component.id }}'] })"
     @open-item-select-modal.window="openModal($event.detail)"
     @hidden.bs.modal="closeModal()">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content item-select-modal"
             style="border-radius: 8px;
                    border: 1px solid #D1D9E2;
                    box-shadow: 0px 2px 12px 0px rgba(145, 145, 145, 0.15)">
            <div class="modal-header">
                <h5 class="modal-title" id="itemSelectModalLabel">Select Component</h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body my-3">
                <div class="content-area" style="max-height: 70vh; overflow-y: auto;">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">Component ID</th>
                                <th scope="col">Workspace</th>
                                <th scope="col">Component Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="item in items" :key="item.item_key">
                                <tr @click="selectedItemId = item.item_key" style="cursor: pointer;">
                                    <td>
                                        <input type="radio"
                                               class="form-check-input"
                                               name="selected-item"
                                               :value="item.item_key"
                                               x-model="selectedItemId">
                                    </td>
                                    <td x-text="item.item_key"></td>
                                    <td x-text="item.team_name"></td>
                                    <td x-text="item.item_name"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <div x-show="isLoading" class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                <!-- Pagination Controls -->
                <div x-data="{ get totalPages() { return $data.paginationMeta?.total_pages || 0 }, get startItem() { return (($data.currentPage - 1) * $data.pageSize) + 1 }, get endItem() { return Math.min($data.currentPage * $data.pageSize, $data.totalItems) }, get totalItems() { return $data.paginationMeta?.total || 0 }, get pageSizeOptions() { return [10, 15, 25, 50] }, get visiblePages() { const total = this.totalPages; const current = $data.currentPage; const delta = 2; const range = []; for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) { range.push(i); } if (current - delta > 2) range.unshift('...'); if (current + delta < total - 1) range.push('...'); range.unshift(1); if (total > 1) range.push(total); return range; }, get ellipsis() { return '...' }, goToPage(page) { $data.goToPage(page) }, handlePageSizeChange(event) { $data.pageSize = parseInt(event.target.value); $data.loadItems() } }">
                    {% include 'core/components/pagination_controls.html.j2' %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-link text-black text-decoration-none"
                        data-bs-dismiss="modal">Cancel</button>
                <button type="button"
                        class="btn btn-primary"
                        :disabled="!selectedItemId"
                        @click="confirmSelection()">Select</button>
            </div>
        </div>
    </div>
</div>
