{% extends "core/base.html.j2" %}
{% load static %}
{% load django_vite %}
{% block title %}Get Started - sbomify{% endblock %}
{% block styles %}
    <style>
        .onboarding-bg {
            background:
                radial-gradient(ellipse 80% 60% at 50% 0%, rgb(var(--color-primary) / 0.08) 0%, transparent 60%),
                radial-gradient(ellipse 50% 40% at 80% 100%, rgb(var(--color-primary) / 0.04) 0%, transparent 50%),
                rgb(var(--color-background));
        }
        :root.light .onboarding-bg {
            background:
                radial-gradient(ellipse 80% 60% at 50% 0%, rgb(var(--color-primary) / 0.06) 0%, transparent 60%),
                radial-gradient(ellipse 50% 40% at 80% 100%, rgb(var(--color-primary) / 0.03) 0%, transparent 50%),
                rgb(var(--color-background));
        }
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 9999px;
            background-color: rgb(var(--color-border));
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .step-dot.active {
            width: 28px;
            background-color: rgb(var(--color-primary));
        }
        .step-dot.completed {
            background-color: rgb(var(--color-success));
        }
        .onboarding-card {
            border: 1px solid rgb(var(--color-border) / 0.6);
            box-shadow:
                0 4px 24px -4px rgb(0 0 0 / 0.12),
                0 0 0 1px rgb(var(--color-border) / 0.3);
        }
        :root.dark .onboarding-card {
            box-shadow:
                0 8px 32px -4px rgb(0 0 0 / 0.4),
                0 0 0 1px rgb(255 255 255 / 0.04);
        }
        .success-ring {
            animation: success-pulse 2s ease-out 0.8s;
        }
        @keyframes success-pulse {
            0% { box-shadow: 0 0 0 0 rgb(var(--color-success) / 0.4); }
            70% { box-shadow: 0 0 0 16px rgb(var(--color-success) / 0); }
            100% { box-shadow: 0 0 0 0 rgb(var(--color-success) / 0); }
        }
        @media (prefers-reduced-motion: reduce) {
            .step-dot { transition: none; }
            .success-ring { animation: none; }
        }
    </style>
{% endblock %}
{% block main %}
    <div class="onboarding-bg min-h-screen flex flex-col items-center justify-center px-4 py-12 sm:py-16">
        <!-- Logo -->
        <div class="flex items-center justify-center gap-3 mb-10">
            <img src="{% static 'img/sbomify-icon.svg' %}"
                 alt=""
                 class="h-8 w-8"
                 width="32"
                 height="32">
            <span class="text-2xl font-bold text-text tracking-tight">sbomify</span>
        </div>
        <!-- Step Progress -->
        <div class="flex items-center gap-2 mb-8">
            <div class="step-dot {% if current_step == 'welcome' %}active{% elif current_step == 'setup' or current_step == 'complete' %}completed{% endif %}">
            </div>
            <div class="step-dot {% if current_step == 'setup' %}active{% elif current_step == 'complete' %}completed{% endif %}">
            </div>
            <div class="step-dot {% if current_step == 'complete' %}active{% endif %}"></div>
        </div>
        {% if current_step == 'welcome' %}
            <!-- Welcome Step -->
            <div class="w-full max-w-md"
                 x-data="{ show: false }"
                 x-init="setTimeout(() => show = true, 80)">
                <div class="onboarding-card bg-surface rounded-2xl overflow-hidden"
                     x-show="show"
                     x-transition:enter="transition ease-out duration-500"
                     x-transition:enter-start="opacity-0 translate-y-3"
                     x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="px-8 sm:px-10 pt-10 sm:pt-12 pb-8 sm:pb-10 text-center">
                        <h1 class="font-display text-2xl sm:text-3xl font-bold text-text mb-3 tracking-tight">Welcome, {{ first_name }}</h1>
                        <p class="text-text-muted text-sm sm:text-base leading-relaxed mb-8">
                            Know exactly what's inside your software â€” and keep it secure.
                        </p>
                        <!-- Value highlights -->
                        <div class="flex flex-col gap-3 mb-8 text-left">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0">
                                    <i class="fas fa-upload text-primary text-xs"></i>
                                </div>
                                <span class="text-text-secondary text-sm">See every component in your software supply chain</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0">
                                    <i class="fas fa-search text-primary text-xs"></i>
                                </div>
                                <span class="text-text-secondary text-sm">Find vulnerabilities before they become problems</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0">
                                    <i class="fas fa-check-circle text-primary text-xs"></i>
                                </div>
                                <span class="text-text-secondary text-sm">Stay compliant with security standards</span>
                            </div>
                        </div>
                        <a href="{% url 'teams:onboarding_wizard' %}?step=setup"
                           class="btn-primary-action flex items-center justify-center gap-2.5 w-full py-3.5 px-4 text-base font-semibold rounded-xl no-underline">
                            Get Started
                            <i class="fas fa-arrow-right text-sm"></i>
                        </a>
                    </div>
                </div>
                <p class="text-center text-text-muted/60 text-xs mt-6">Takes about 2 minutes</p>
            </div>
        {% elif current_step == 'setup' %}
            <!-- Setup Step -->
            <div class="w-full max-w-md"
                 x-data="onboardingWizard({ initialEmail: '{{ form.email.value|default:''|escapejs }}', initialContactName: '{{ form.contact_name.value|default:''|escapejs }}' })">
                <div class="onboarding-card bg-surface rounded-2xl overflow-hidden">
                    <div class="px-8 sm:px-10 pt-8 sm:pt-10 pb-6 sm:pb-8">
                        <!-- Header -->
                        <div class="mb-8">
                            <p class="text-primary text-xs font-semibold uppercase tracking-widest mb-2">Step 1 of 2</p>
                            <h1 class="font-display text-2xl font-bold text-text mb-1.5 tracking-tight">Create your workspace</h1>
                            <p class="text-text-muted text-sm">Tell us about your organization. You can change this later.</p>
                        </div>
                        <form method="post"
                              action="{% url 'teams:onboarding_wizard' %}"
                              @submit="handleSubmit()">
                            {% csrf_token %}
                            {% if form.non_field_errors %}
                                <div class="tw-form-error mb-6" role="alert">
                                    {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                            <div class="space-y-5">
                                <!-- Company Name -->
                                <div>
                                    <label for="id_company_name" class="tw-form-label tw-form-label-required">Company name</label>
                                    <input type="text"
                                           class="tw-form-input"
                                           id="id_company_name"
                                           name="company_name"
                                           placeholder="e.g., Acme Corporation"
                                           required
                                           minlength="2"
                                           maxlength="200"
                                           autocomplete="organization"
                                           autofocus
                                           x-model="companyName"
                                           @blur="markTouched('companyName')"
                                           :class="getValidationClass('companyName')"
                                           {% if form.company_name.value %}value="{{ form.company_name.value }}"{% endif %}>
                                    {% if form.company_name.errors %}
                                        <div class="tw-form-error">
                                            {% for error in form.company_name.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="tw-form-helper">Used to name your workspace and Trust Center.</p>
                                </div>
                                <!-- Contact Name -->
                                <div>
                                    <label for="id_contact_name" class="tw-form-label tw-form-label-required">Your name</label>
                                    <input type="text"
                                           class="tw-form-input"
                                           id="id_contact_name"
                                           name="contact_name"
                                           placeholder="e.g., Jane Smith"
                                           required
                                           minlength="2"
                                           maxlength="150"
                                           autocomplete="name"
                                           x-model="contactName"
                                           @blur="markTouched('contactName')"
                                           :class="getValidationClass('contactName')"
                                           {% if form.contact_name.value %}value="{{ form.contact_name.value }}"{% endif %}>
                                    {% if form.contact_name.errors %}
                                        <div class="tw-form-error">
                                            {% for error in form.contact_name.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="tw-form-helper">Required for NTIA compliance. Person responsible for SBOM inquiries.</p>
                                </div>
                                <!-- Email -->
                                <div>
                                    <label for="id_email" class="tw-form-label">Work email</label>
                                    <input type="email"
                                           class="tw-form-input"
                                           id="id_email"
                                           name="email"
                                           placeholder="security@example.com"
                                           maxlength="254"
                                           autocomplete="email"
                                           x-model="email"
                                           @blur="markTouched('email')"
                                           :class="getValidationClass('email')"
                                           {% if form.email.value %}value="{{ form.email.value }}"{% endif %}>
                                    {% if form.email.errors %}
                                        <div class="tw-form-error">
                                            {% for error in form.email.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="tw-form-helper">Embedded in SBOM metadata for security inquiries.</p>
                                </div>
                                <!-- Website -->
                                <div>
                                    <label for="id_website" class="tw-form-label">
                                        Website <span class="text-text-muted font-normal text-xs">(optional)</span>
                                    </label>
                                    <input type="url"
                                           class="tw-form-input"
                                           id="id_website"
                                           name="website"
                                           placeholder="https://example.com"
                                           maxlength="500"
                                           autocomplete="url"
                                           pattern="https?://.+"
                                           x-model="website"
                                           @blur="markTouched('website')"
                                           :class="getValidationClass('website')"
                                           {% if form.website.value %}value="{{ form.website.value }}"{% endif %}>
                                    {% if form.website.errors %}
                                        <div class="tw-form-error">
                                            {% for error in form.website.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="tw-form-helper">Added to SBOM external references.</p>
                                </div>
                                <!-- Goal -->
                                <div>
                                    <label for="id_goal" class="tw-form-label">
                                        What are you trying to accomplish? <span class="text-text-muted font-normal text-xs">(optional)</span>
                                    </label>
                                    <textarea class="tw-form-input"
                                              id="id_goal"
                                              name="goal"
                                              rows="3"
                                              maxlength="1000"
                                              placeholder="e.g., Track open source dependencies, meet compliance requirements...">{% if form.goal.value %}{{ form.goal.value }}{% endif %}</textarea>
                                    {% if form.goal.errors %}
                                        <div class="tw-form-error">
                                            {% for error in form.goal.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="tw-form-helper">Helps us tailor your experience.</p>
                                </div>
                            </div>
                            <!-- Auto-create note -->
                            <div class="flex items-start gap-2.5 mt-6 p-3 rounded-lg bg-primary/5 border border-primary/10">
                                <i class="fas fa-magic text-primary/60 text-xs mt-0.5"></i>
                                <p class="text-xs text-text-muted leading-relaxed">
                                    We'll set up a sample product, project, and component so you can start exploring right away.
                                </p>
                            </div>
                            <!-- Footer -->
                            <div class="flex items-center justify-between mt-8 pt-6 border-t border-border/50">
                                <a href="{% url 'teams:onboarding_wizard' %}"
                                   class="text-sm text-text-muted hover:text-text no-underline transition-colors flex items-center gap-1.5">
                                    <i class="fas fa-arrow-left text-xs"></i> Back
                                </a>
                                <button type="submit"
                                        class="btn-primary-action py-2.5 px-8 text-sm font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed"
                                        :disabled="!canSubmit">
                                    <span x-show="!isSubmitting" class="flex items-center gap-2">
                                        Create Workspace
                                        <i class="fas fa-arrow-right text-xs"></i>
                                    </span>
                                    <span x-show="isSubmitting" x-cloak class="flex items-center gap-2">
                                        <i class="fas fa-circle-notch animate-spin"></i>
                                        Creating...
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        {% elif current_step == 'complete' %}
            <!-- Success Step -->
            <div class="w-full max-w-md"
                 x-data="{ show: false }"
                 x-init="setTimeout(() => show = true, 80)">
                <div class="onboarding-card bg-surface rounded-2xl overflow-hidden"
                     x-show="show"
                     x-transition:enter="transition ease-out duration-500"
                     x-transition:enter-start="opacity-0 translate-y-3"
                     x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="px-8 sm:px-10 pt-10 sm:pt-12 pb-8 sm:pb-10">
                        <!-- Animated checkmark -->
                        <div class="text-center">
                            <div class="relative mx-auto mb-8 w-20 h-20"
                                 x-data="{ scaled: false }"
                                 x-init="setTimeout(() => scaled = true, 250)">
                                <div class="absolute inset-0 rounded-full bg-success/10 success-ring"></div>
                                <div class="absolute inset-0 flex items-center justify-center rounded-full bg-success/10 transition-transform duration-500 ease-out"
                                     :class="scaled ? 'scale-100' : 'scale-0'">
                                    <i class="fas fa-check text-success text-3xl"></i>
                                </div>
                            </div>
                            <h1 class="font-display text-2xl sm:text-3xl font-bold text-text mb-3 tracking-tight">Your workspace is ready!</h1>
                            <p class="text-text-muted text-sm sm:text-base leading-relaxed mb-8">
                                <strong class="text-text font-medium">{{ company_name }}</strong> is set up. Let's explore what sbomify can do for you.
                            </p>
                        </div>
                        <!-- Onboarding checklist -->
                        <div class="rounded-xl border border-border/50 divide-y divide-border/50 mb-8">
                            <div class="flex items-center gap-3 px-4 py-3">
                                <div class="w-5 h-5 rounded-full bg-success/20 flex items-center justify-center shrink-0">
                                    <i class="fas fa-check text-success text-[10px]"></i>
                                </div>
                                <span class="text-sm text-text-muted line-through">Create workspace</span>
                            </div>
                            <div class="flex items-center gap-3 px-4 py-3">
                                <div class="w-5 h-5 rounded-full border-2 border-primary shrink-0"></div>
                                <span class="text-sm text-text">Explore with a sample project</span>
                            </div>
                            <div class="flex items-center gap-3 px-4 py-3">
                                <div class="w-5 h-5 rounded-full border-2 border-border shrink-0"></div>
                                <span class="text-sm text-text-muted">See your first security insights</span>
                            </div>
                        </div>
                        <!-- Actions -->
                        <a href="{{ next_url|default:'/dashboard' }}"
                           class="btn-primary-action flex items-center justify-center gap-2.5 w-full py-3.5 px-4 text-base font-semibold rounded-xl no-underline mb-3">
                            Continue
                            <i class="fas fa-arrow-right text-sm"></i>
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
{% block scripts %}
    {% vite_asset 'sbomify/apps/teams/js/main.ts' %}
{% endblock %}
