{% extends "./base.html.j2" %}
{% load static %}
{% load cache %}
{% block title %}sbomify{% endblock %}
{% block main %}
    {# WebSocket connection for real-time updates #}
    {% if request.session.current_team and request.session.current_team.key %}
        <div x-data
             x-init="$store.ws.connect('{{ request.session.current_team.key }}')"
             class="hidden"></div>
    {% endif %}
    {# Layout Container #}
    <div class="min-h-screen flex flex-col bg-background"
         x-data="{ sidebarCollapsed: $persist(false).as('sidebar-collapsed'), sidebarMobileOpen: false }"
         @keydown.escape.window="sidebarMobileOpen = false">
        {# Sidebar #}
        {% cache 300 'sidebar' request.user.id request.session.current_team.id request.session.user_teams_version request.resolver_match.url_name %}
        {% include "core/components/sidebar.html.j2" %}
    {% endcache %}
    {# Header #}
    {% cache 300 'header' request.user.id request.session.current_team.id has_pending_invitations request.session.user_teams_version %}
    {% include "core/components/header.html.j2" %}
{% endcache %}
{# Main Content #}
<main id="main-content"
      class="flex-1 pt-16 pl-0 lg:pl-64 transition-all duration-300"
      :class="{ 'lg:!pl-16': sidebarCollapsed }">
    <div class="p-6 max-w-7xl mx-auto">
        {# HTMX Messages (toast-based) #}
        {% include "core/components/messages.htmx.j2" %}
        {# Site Notifications #}
        {% include "core/components/site_notifications.html.j2" %}
        {# Page Content #}
        {% block dashboard_content %}{% endblock %}
        {% block content %}{% endblock %}
    </div>
</main>
{# Footer #}
{% include "core/components/footer.html.j2" %}
</div>
{# Create Modals #}
{% with current_team=request.session.current_team %}
    {% if current_team %}
        {% if current_team.role == "owner" or current_team.role == "admin" %}
            {% include "core/components/create_modals.html.j2" %}
        {% endif %}
    {% endif %}
{% endwith %}
{% endblock %}
