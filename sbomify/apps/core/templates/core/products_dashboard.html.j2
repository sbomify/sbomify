{% extends "core/dashboard_base.htmx.j2" %}
{% load static %}
{% block title %}sbomify Products{% endblock %}
{% block dashboard_content %}
    <div class="space-y-6">
        {# Page Header with Stats #}
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div class="flex items-center gap-4">
                <div class="tw-avatar tw-avatar-lg">
                    <i class="fas fa-cube"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-text">Products</h1>
                    <p class="text-text-muted text-sm">Manage and organize your software products</p>
                </div>
            </div>
        </div>
        {# Products Table #}
        {% include 'core/products_table.html.j2' %}
        {# Add Product Modal (Alpine.js) #}
        {% if has_crud_permissions %}
            <div x-data="{ open: false }" @open-add-product-modal.window="open = true">
                <template x-teleport="body">
                    <div x-show="open"
                         x-cloak
                         class="fixed inset-0 z-[100]"
                         role="dialog"
                         aria-modal="true"
                         aria-labelledby="addProductModalLabel">
                        <div x-show="open"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0"
                             x-transition:enter-end="opacity-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100"
                             x-transition:leave-end="opacity-0"
                             class="tw-modal-overlay"
                             @click="open = false"></div>
                        <div class="tw-modal"
                             x-show="open"
                             x-trap.noscroll="open"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 scale-100"
                             x-transition:leave-end="opacity-0 scale-95"
                             @click.stop
                             @keydown.escape="if(open) open = false">
                            <div class="tw-modal-content">
                                <div class="tw-modal-header">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                                            <i class="fas fa-cube text-primary"></i>
                                        </div>
                                        <h4 id="addProductModalLabel" class="tw-modal-title">New Product</h4>
                                    </div>
                                    <button type="button"
                                            class="tw-modal-close"
                                            @click="open = false"
                                            aria-label="Close">
                                        <i class="fas fa-times" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <p class="px-6 pt-2 text-sm text-text-muted">
                                    A product represents a deliverable you ship to customers, such as an application or service.
                                </p>
                                <form id="addProductForm"
                                      method="post"
                                      action="{% url 'core:products_dashboard' %}">
                                    {% csrf_token %}
                                    <div class="tw-modal-body space-y-4">
                                        <div>
                                            <label class="tw-form-label" for="productName">
                                                Name <span class="text-danger">*</span>
                                            </label>
                                            <input id="productName"
                                                   name="name"
                                                   type="text"
                                                   class="tw-form-input"
                                                   placeholder="Enter product name"
                                                   required />
                                        </div>
                                        <div>
                                            <label class="tw-form-label" for="productDescription">Description</label>
                                            <textarea id="productDescription"
                                                      name="description"
                                                      class="tw-form-input"
                                                      rows="3"
                                                      placeholder="Describe your product..."></textarea>
                                            <p class="mt-1.5 text-xs text-text-muted">Optional. A brief description of your product.</p>
                                        </div>
                                    </div>
                                    <div class="tw-modal-footer">
                                        <button type="button" class="tw-btn-ghost" @click="open = false">Cancel</button>
                                        <button type="submit" class="tw-btn-primary">
                                            <i class="fas fa-plus mr-2"></i>Create Product
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        {% endif %}
    </div>
{% endblock %}
{% block scripts %}{% endblock %}
