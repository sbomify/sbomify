{% load static %}
<div class="tw-card">
    <div class="px-6 py-4 border-b border-border">
        <div class="flex items-center justify-between">
            <div>
                <h4 class="text-lg font-semibold text-text m-0 flex items-center gap-2">
                    <i class="fas fa-puzzle-piece"></i>
                    Assessment Plugins
                </h4>
                <p class="text-text-muted text-sm mt-1 mb-0">Configure which assessment plugins run on your SBOMs</p>
            </div>
        </div>
    </div>
    <div class="p-6">
        <form hx-post="{% url 'plugins:team_plugin_settings' team.key %}"
              hx-swap="none"
              hx-disabled-elt="find button[type='submit']"
              hx-indicator="#plugin-settings-spinner">
            {% csrf_token %}
            {% if plugin_settings.available_plugins %}
                <div class="space-y-3">
                    {% for plugin in plugin_settings.available_plugins %}
                        <div class="p-4 border border-border rounded-lg {% if plugin.requires_upgrade %}opacity-60{% endif %}">
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 pt-0.5">
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox"
                                               name="enabled_plugins"
                                               value="{{ plugin.name }}"
                                               id="plugin-{{ plugin.name }}"
                                               class="sr-only peer"
                                               {% if plugin.name in plugin_settings.enabled_plugins and plugin.has_access %}checked{% endif %}
                                               {% if plugin.requires_upgrade %}disabled{% endif %}>
                                        <div class="w-11 h-6 bg-border rounded-full peer peer-checked:bg-primary peer-focus:ring-4 peer-focus:ring-primary/20 transition-colors">
                                        </div>
                                        <div class="absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform peer-checked:translate-x-5">
                                        </div>
                                    </label>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center flex-wrap gap-2 mb-1">
                                        <label class="font-medium text-text {% if plugin.requires_upgrade %}text-text-muted{% endif %}"
                                               for="plugin-{{ plugin.name }}">{{ plugin.display_name }}</label>
                                        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-primary/10 text-primary capitalize">{{ plugin.category }}</span>
                                        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-border/50 text-text-muted">v{{ plugin.version }}</span>
                                        {% if plugin.is_beta %}
                                            <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-info/10 text-info">
                                                <i class="fas fa-flask mr-1"></i>Beta
                                            </span>
                                        {% endif %}
                                        {% if plugin.requires_upgrade %}
                                            <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-warning/10 text-warning">
                                                <i class="fas fa-lock mr-1"></i>
                                                {{ plugin.required_plan }}+ Plan
                                            </span>
                                        {% endif %}
                                    </div>
                                    <p class="text-text-muted text-sm mb-0">{{ plugin.description }}</p>
                                    {% if plugin.requires_upgrade %}
                                        <div class="mt-3">
                                            <a href="{% url 'billing:select_plan' team.key %}"
                                               class="px-3 py-1.5 text-sm border border-warning text-warning rounded-lg hover:bg-warning/10 transition-colors no-underline inline-flex items-center gap-1">
                                                <i class="fas fa-arrow-up"></i>
                                                Upgrade to Enable
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="flex items-center justify-between mt-6 pt-4 border-t border-border">
                    <div class="text-text-muted text-sm flex items-center gap-1">
                        <i class="fas fa-info-circle"></i>
                        Enabled plugins will automatically assess new SBOM uploads.
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="plugin-settings-spinner"
                              class="htmx-indicator animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"></span>
                        <button type="submit" class="tw-btn-primary">
                            <i class="fas fa-save mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            {% else %}
                <div class="text-center text-text-muted py-8">
                    <i class="fas fa-puzzle-piece text-4xl mb-3 block opacity-50"></i>
                    <p class="mb-1">No assessment plugins are currently available.</p>
                    <p class="text-sm">Plugins will appear here once they are registered by administrators.</p>
                </div>
            {% endif %}
        </form>
    </div>
</div>
<!-- Info Card about Plugin Behavior -->
<div class="tw-card mt-6">
    <div class="px-6 py-4 border-b border-border">
        <h5 class="text-lg font-semibold text-text m-0 flex items-center gap-2">
            <i class="fas fa-info-circle text-info"></i>
            About Assessment Plugins
        </h5>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h6 class="font-medium text-text mb-2 flex items-center gap-2">
                    <i class="fas fa-check-circle text-success"></i>
                    Automatic Assessments
                </h6>
                <p class="text-text-muted text-sm mb-0">
                    Enabled plugins automatically run assessments when new SBOMs are uploaded.
                    Results appear on the SBOM detail page and in the SBOMs table.
                </p>
            </div>
            <div>
                <h6 class="font-medium text-text mb-2 flex items-center gap-2">
                    <i class="fas fa-history text-info"></i>
                    Historical Tracking
                </h6>
                <p class="text-text-muted text-sm mb-0">
                    All assessment results are preserved, allowing you to track compliance
                    and security status over time for audit purposes.
                </p>
            </div>
            <div>
                <h6 class="font-medium text-text mb-2 flex items-center gap-2">
                    <i class="fas fa-shield-alt text-primary"></i>
                    Compliance Plugins
                </h6>
                <p class="text-text-muted text-sm mb-0">
                    Compliance plugins like NTIA Minimum Elements verify that your SBOMs
                    meet industry standards and regulatory requirements.
                </p>
            </div>
            <div>
                <h6 class="font-medium text-text mb-2 flex items-center gap-2">
                    <i class="fas fa-cog text-text-muted"></i>
                    Per-Plugin Configuration
                </h6>
                <p class="text-text-muted text-sm mb-0">
                    Some plugins support custom configuration. Configuration options
                    will appear when the plugin is enabled.
                </p>
            </div>
        </div>
    </div>
</div>
