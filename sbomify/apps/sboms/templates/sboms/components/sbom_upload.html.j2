{% load static %}
<link rel="stylesheet"
      href="{% static 'css/components/standard-card.css' %}">
<link rel="stylesheet" href="{% static 'css/components/sbom-upload.css' %}">
<div class="standard-card"
     x-cloak
     x-data="sbomUpload('{{ component_id }}', {{ component.sbom_count|default:0 }} > 0)">
    <div class="bg-white rounded-lg shadow-sm"
         :class="{ 'card-collapsed': !expanded }">
        <div class="px-6 py-4 border-b collapsible-header sbom-upload-header cursor-pointer"
             @click="expanded = !expanded"
             role="button"
             tabindex="0"
             @keydown.enter="expanded = !expanded"
             @keydown.space.prevent="expanded = !expanded"
             :aria-expanded="expanded"
             aria-controls="sbom-upload-body">
            <div class="header-content">
                <h4 class="text-lg font-semibold mb-0">
                    <i class="fas fa-upload mr-2" aria-hidden="true"></i>Upload SBOM File
                    <i class="fas ml-2"
                       :class="expanded ? 'fa-chevron-up' : 'fa-chevron-down'"
                       aria-hidden="true"></i>
                </h4>
            </div>
        </div>
        <div class="p-6" id="sbom-upload-body" x-show="expanded" x-collapse>
            <!-- Info Notice -->
            <div class="augmentation-notice mb-3 flex items-center">
                <i class="fas fa-info-circle mr-2 text-brand-primary"></i>
                <strong>Recommended:</strong> Use the CI/CD Integration section below for automated SBOM uploads. Manual uploads are useful for one-time uploads, testing, or when automated workflows aren't available.
            </div>
            <!-- Upload Area -->
            <div class="sbom-upload-area"
                 :class="{ 'drag-over': isDragOver, 'uploading': isUploading }"
                 role="button"
                 aria-label="Upload SBOM file by dropping or clicking"
                 :aria-busy="isUploading"
                 tabindex="0"
                 @drop.prevent="!isUploading && handleDrop($event)"
                 @dragover.prevent="!isUploading && (isDragOver = true)"
                 @dragleave="!isUploading && (isDragOver = false)"
                 @dragenter.prevent
                 @keydown.enter="!isUploading && $refs.fileInput && $refs.fileInput.click()"
                 @keydown.space.prevent="!isUploading && $refs.fileInput && $refs.fileInput.click()">
                <!-- Default state -->
                <template x-if="!isUploading">
                    <div class="sbom-upload-content">
                        <div class="sbom-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="sbom-upload-text">
                            <strong>Drop your SBOM file here</strong> or
                            <label class="sbom-upload-link">
                                <input type="file"
                                       x-ref="fileInput"
                                       accept=".json,.spdx,.cdx"
                                       class="sr-only"
                                       @change="handleFileSelect($event)">
                                click to browse
                            </label>
                        </p>
                        <p class="sbom-upload-hint">Supports CycloneDX (.json, .cdx) and SPDX (.json, .spdx) formats</p>
                    </div>
                </template>
                <!-- Uploading state -->
                <template x-if="isUploading">
                    <div class="sbom-upload-progress">
                        <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-brand-primary border-r-transparent"
                             role="status">
                            <span class="sr-only">Uploading...</span>
                        </div>
                        <p class="mt-2">Uploading and processing SBOM...</p>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>
