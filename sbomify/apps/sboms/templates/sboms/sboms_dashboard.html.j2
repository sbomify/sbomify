{% extends "core/dashboard_base.htmx.j2" %}
{% load widget_tweaks %}
{% load form_helpers %}
{% load django_vite %}
{% block title %}sbomify SBOMs{% endblock %}
{% block content %}
    <div>
        {# Page Header #}
        <div class="mb-6">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <i class="fas fa-file-code text-primary text-lg"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-text">SBOMs</h1>
                    <p class="text-text-muted text-sm">Software Bill of Materials across all components</p>
                </div>
            </div>
        </div>
        {# Upload Card #}
        {% if has_crud_permissions %}
            <div class="tw-card mb-6">
                <div class="px-6 py-4 border-b border-border">
                    <h4 class="text-lg font-semibold text-text">Upload SBOM File</h4>
                </div>
                <div class="p-6">
                    <form action="{% url 'sboms:sboms_dashboard' %}"
                          method="post"
                          enctype="multipart/form-data"
                          class="flex flex-wrap items-center gap-4">
                        {% csrf_token %}
                        <div>{{ sbom_upload_form.sbom_file }}</div>
                        <button type="submit" class="tw-btn-primary">
                            <i class="fas fa-upload mr-2"></i>Upload
                        </button>
                    </form>
                </div>
            </div>
        {% endif %}
        {# SBOMs Table #}
        <div class="tw-card">
            <div class="px-6 py-4 border-b border-border">
                <h4 class="text-lg font-semibold text-text">All SBOMs</h4>
            </div>
            <div class="p-0">
                {% if sboms %}
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-border bg-background/50">
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-text-muted uppercase tracking-wider">Version</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-text-muted uppercase tracking-wider">Visibility</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-text-muted uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-border">
                                {% for sbom in sboms %}
                                    <tr class="hover:bg-background/50 transition-colors">
                                        <td class="px-6 py-4">
                                            <a href="{% url 'core:component_item' component_id=sbom.component_id item_type='sboms' item_id=sbom.id %}"
                                               class="text-primary font-medium hover:underline">{{ sbom.name }}</a>
                                        </td>
                                        <td class="px-6 py-4 text-text">{{ sbom.version }}</td>
                                        <td class="px-6 py-4 text-center">
                                            {% if sbom.public_access_allowed %}
                                                <span class="tw-badge-success">Public</span>
                                            {% else %}
                                                <span class="tw-badge-secondary">Private</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <a href="{% url 'core:component_item' component_id=sbom.component_id item_type='sboms' item_id=sbom.id %}"
                                               class="p-2 rounded-lg text-primary hover:bg-primary/10 transition-colors"
                                               title="View details">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="flex flex-col items-center justify-center py-12 px-6">
                        <div class="w-16 h-16 rounded-full bg-border/30 flex items-center justify-center mb-4">
                            <i class="fas fa-file-code text-2xl text-text-muted"></i>
                        </div>
                        <p class="text-text-muted text-center">No SBOMs uploaded yet</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
