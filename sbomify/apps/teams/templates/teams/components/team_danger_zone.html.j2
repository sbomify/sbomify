{% load static %}
<div x-cloak
     x-data="{ showDeleteModal: false, confirmText: '', isExpanded: false, get canConfirm() { return this.confirmText.toLowerCase() === 'delete'; } }">
    {# Danger Zone Section - Collapsible #}
    <div class="tw-dangerzone-card">
        <div class="tw-card-header cursor-pointer select-none"
             role="button"
             tabindex="0"
             :aria-expanded="isExpanded"
             @click="isExpanded = !isExpanded"
             @keydown.enter.prevent="isExpanded = !isExpanded"
             @keydown.space.prevent="isExpanded = !isExpanded">
            <i class="fas fa-exclamation-triangle text-danger" aria-hidden="true"></i>
            <div>
                <h6 class="text-base font-semibold text-danger m-0">Danger Zone</h6>
                <p class="text-text-muted text-sm m-0">Irreversible and destructive actions</p>
            </div>
            <i class="fas text-danger transition-transform ml-auto"
               :class="isExpanded ? 'fa-chevron-up' : 'fa-chevron-down'"
               aria-hidden="true"></i>
        </div>
        <div x-show="isExpanded" x-collapse class="tw-card-body">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-lg bg-danger/10 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-trash-alt text-danger" aria-hidden="true"></i>
                    </div>
                    <div>
                        <h6 class="font-medium text-text mb-1">Delete Workspace</h6>
                        <p class="text-sm text-text-muted m-0">Permanently remove this workspace and all its associated data.</p>
                        {% if is_default_team %}
                            <p class="text-sm text-warning m-0 mt-2">
                                <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
                                You must set another workspace as default before deleting this one.
                            </p>
                        {% endif %}
                    </div>
                </div>
                <button id="del_{{ team_key }}"
                        class="tw-btn-danger tw-btn-sm flex-shrink-0"
                        {% if is_default_team %}disabled{% endif %}
                        @click.prevent.stop="showDeleteModal = true"
                        aria-label="Delete workspace {{ team_name }}">
                    <i class="fas fa-trash-alt mr-2" aria-hidden="true"></i>
                    Delete Workspace
                </button>
            </div>
        </div>
    </div>
    {# Custom Delete Modal for Workspace #}
    <template x-teleport="body">
        <div x-show="showDeleteModal"
             x-cloak
             class="fixed inset-0 z-[100]"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="deleteWorkspaceModalLabel"
             aria-describedby="deleteWorkspaceModalDesc"
             tabindex="-1">
            <div x-show="showDeleteModal"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 class="tw-modal-overlay"
                 @click="showDeleteModal = false; confirmText = ''"></div>
            <div class="tw-modal"
                 x-show="showDeleteModal"
                 x-trap.noscroll="showDeleteModal"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.stop
                 @keydown.escape="if(showDeleteModal) { showDeleteModal = false; confirmText = ''; }">
                <div class="tw-modal-content">
                    <div class="tw-modal-header">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-danger/10 flex items-center justify-center text-danger">
                                <i class="fas fa-exclamation-triangle text-xl" aria-hidden="true"></i>
                            </div>
                            <h4 id="deleteWorkspaceModalLabel" class="tw-modal-title">Delete Workspace</h4>
                        </div>
                        <button type="button"
                                class="tw-modal-close"
                                @click="showDeleteModal = false; confirmText = ''"
                                aria-label="Close">
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="tw-modal-body">
                        <p class="text-text mb-2">
                            Are you sure you want to delete the workspace
                            <span class="font-semibold text-danger">{{ team_name }}</span>?
                        </p>
                        <p id="deleteWorkspaceModalDesc" class="text-sm text-text-muted mb-4">
                            This action cannot be undone. All products, projects, components, SBOMs, and documents in this workspace will be permanently deleted.
                        </p>
                        <label for="delete-confirm-{{ team_key }}"
                               class="text-sm text-text mb-2 block">
                            Type <strong>delete</strong> to confirm:
                        </label>
                        <input id="delete-confirm-{{ team_key }}"
                               x-model="confirmText"
                               type="text"
                               class="tw-form-input"
                               placeholder="Type 'delete' to confirm"
                               autocomplete="off"
                               @keydown.enter="if (canConfirm) $refs.deleteForm.submit()">
                    </div>
                    <div class="tw-modal-footer">
                        <button type="button"
                                class="tw-btn-ghost"
                                @click="showDeleteModal = false; confirmText = ''">Cancel</button>
                        <form x-ref="deleteForm"
                              method="post"
                              action="{% url 'teams:team_general' team_key %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete">
                            <button type="submit" class="tw-btn-danger" :disabled="!canConfirm">
                                <i class="fas fa-trash mr-2" aria-hidden="true"></i>Delete Workspace
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </template>
</div>
