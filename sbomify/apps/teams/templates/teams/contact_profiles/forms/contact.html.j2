{% load widget_tweaks %}
<div class="contact-card border-bottom"
     x-cloak
     x-data="contactEntry()"
     x-show="!deleted"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100">
    {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
    <input type="hidden"
           name="{{ form.prefix }}-DELETE"
           x-model="deleted"
           value="">
    <div class="flex items-center py-2 px-3 gap-3">
        {# Contact avatar #}
        <div class="flex-shrink-0">
            <div class="contact-avatar-circle">
                <i class="fas fa-user-pen contact-icon-purple"></i>
            </div>
        </div>
        {# Name field - required only if contact is not deleted AND parent entity is visible #}
        <div class="flex-shrink-0 contact-field-name">
            <input type="text"
                   name="{{ form.name.html_name }}"
                   id="{{ form.name.id_for_label }}"
                   value="{{ form.name.value|default:'' }}"
                   class="px-2 py-1 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                   placeholder="Name *"
                   maxlength="255"
                   :required="!deleted && editing"
                   title="Click to edit name"
                   aria-label="Contact Name">
            {% if form.name.errors %}<div class="text-danger-500 text-sm mt-1">{{ form.name.errors.0 }}</div>{% endif %}
        </div>
        {# Email field #}
        <div class="flex-grow-1 contact-field-email">
            <input type="email"
                   name="{{ form.email.html_name }}"
                   id="{{ form.email.id_for_label }}"
                   value="{{ form.email.value|default:'' }}"
                   class="px-2 py-1 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent"
                   placeholder="Email *"
                   maxlength="254"
                   :required="!deleted && editing"
                   title="Please enter a valid email address (e.g., contact@example.com)"
                   aria-label="Contact Email">
            {% if form.email.errors %}<div class="text-danger-500 text-sm mt-1">{{ form.email.errors.0 }}</div>{% endif %}
        </div>
        {# Phone field #}
        <div class="flex-shrink-0 contact-field-phone">
            {{ form.phone|add_class:"px-2 py-1 text-sm border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent"|attr:"placeholder:Phone"|attr:"title:Click to edit phone"|attr:"aria-label:Contact Phone" }}
        </div>
        {# Remove button #}
        <div class="flex-shrink-0">
            <button type="button"
                    class="p-1 text-gray-400 hover:text-gray-600 focus:outline-none"
                    @click="removeContact"
                    title="Remove contact"
                    aria-label="Remove contact">
                <i class="fas fa-trash-alt text-danger-500"></i>
            </button>
        </div>
    </div>
    {# Contact Role Checkboxes #}
    <div class="px-3 pb-2">
        <div class="flex flex-wrap gap-3 ml-5 pl-2">
            {# Author checkbox #}
            <div class="flex items-center">
                <input type="checkbox"
                       name="{{ form.is_author.html_name }}"
                       id="{{ form.is_author.id_for_label }}"
                       class="w-4 h-4 text-brand-primary border-gray-300 rounded focus:ring-brand-primary"
                       {% if form.is_author.value %}checked{% endif %}
                       x-model="isAuthor">
                <label class="ml-2 text-sm" for="{{ form.is_author.id_for_label }}">
                    <i class="fas fa-pen-fancy mr-1 text-gray-600"></i>Author
                </label>
            </div>
            {# Security Contact checkbox #}
            <div class="flex items-center"
                 :title="securityContactDisabled && !isSecurityContact ? 'Another contact is already designated as the security contact for this profile' : 'Security/vulnerability reporting contact (CRA requirement)'">
                <input type="checkbox"
                       name="{{ form.is_security_contact.html_name }}"
                       id="{{ form.is_security_contact.id_for_label }}"
                       class="w-4 h-4 text-brand-primary border-gray-300 rounded focus:ring-brand-primary"
                       {% if form.is_security_contact.value %}checked{% endif %}
                       x-model="isSecurityContact"
                       :disabled="securityContactDisabled && !isSecurityContact">
                <label class="ml-2 text-sm"
                       for="{{ form.is_security_contact.id_for_label }}"
                       :class="securityContactDisabled && !isSecurityContact ? 'text-gray-600' : ''">
                    <i class="fas fa-shield-halved mr-1 text-gray-600"></i>Security Contact
                </label>
            </div>
            {# Technical Contact checkbox #}
            <div class="flex items-center">
                <input type="checkbox"
                       name="{{ form.is_technical_contact.html_name }}"
                       id="{{ form.is_technical_contact.id_for_label }}"
                       class="w-4 h-4 text-brand-primary border-gray-300 rounded focus:ring-brand-primary"
                       {% if form.is_technical_contact.value %}checked{% endif %}
                       x-model="isTechnicalContact">
                <label class="ml-2 text-sm"
                       for="{{ form.is_technical_contact.id_for_label }}">
                    <i class="fas fa-code mr-1 text-gray-600"></i>Technical Contact
                </label>
            </div>
        </div>
    </div>
</div>
