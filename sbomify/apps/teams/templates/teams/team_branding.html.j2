{% load static %}
{% load utils %}
<div id="team-branding-content"
     class="tw-settings-card"
     x-cloak
     x-data="teamBranding('{{ branding_info|pydantic_json|escapejs }}')">
    {# Card Header #}
    <div class="px-6 py-4 border-b border-border">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                    <i class="fas fa-palette text-primary"></i>
                </div>
                <div>
                    <h5 class="text-lg font-semibold text-text m-0">Branding</h5>
                    <p class="text-text-muted text-sm m-0">Customize your workspace's visual identity</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button x-show="hasUnsavedChanges()"
                        type="button"
                        class="tw-btn-secondary tw-btn-sm"
                        @click="$dispatch('refreshTeamBranding')">
                    <i class="fas fa-undo mr-2"></i>Cancel
                </button>
                <button type="submit"
                        id="team-branding-save-btn"
                        form="team-branding-form"
                        class="tw-btn-primary tw-btn-sm"
                        :disabled="!hasUnsavedChanges()">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
    {# Card Content #}
    <div class="p-6">
        <form id="team-branding-form"
              method="post"
              enctype="multipart/form-data"
              hx-post="{% url 'teams:team_branding' team.key %}"
              hx-disabled-elt="#team-branding-save-btn"
              hx-swap="none">
            {% csrf_token %}
            {# Brand Colors Section #}
            <div class="bg-background/50 border border-border rounded-xl p-5 mb-4">
                <div class="flex items-start justify-between gap-3 mb-4">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-lg bg-border/50 flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-swatchbook text-text-muted text-sm"></i>
                        </div>
                        <div>
                            <h6 class="text-base font-semibold text-text m-0">Brand Colors</h6>
                            <p class="text-text-muted text-sm m-0">Define your primary brand colors for consistent visual identity</p>
                        </div>
                    </div>
                    <button type="button"
                            class="tw-btn-ghost tw-btn-sm"
                            @click="setDefaultColors">
                        <i class="fas fa-undo mr-1"></i>Reset
                    </button>
                </div>
                <div class="ml-11">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {# Primary Brand Color #}
                        <div class="bg-background border border-border rounded-xl p-5">
                            <div class="flex items-start gap-4">
                                <div class="relative group">
                                    <div class="w-20 h-20 rounded-xl border-2 border-border overflow-hidden shadow-sm group-hover:shadow-md transition-shadow cursor-pointer"
                                         :style="'background-color: ' + uiColors.brand_color">
                                        <input type="color"
                                               id="brand-color"
                                               class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                               x-model="uiColors.brand_color"
                                               :value="uiColors.brand_color"
                                               @input="updateColor('brand_color', $event.target.value)">
                                    </div>
                                    <input type="hidden"
                                           name="brand_color"
                                           :value="localBrandingInfo.brand_color || ''">
                                </div>
                                <div class="flex-1 pt-1">
                                    <label for="brand-color" class="text-sm font-semibold text-text block mb-2">Primary Brand Color</label>
                                    <code class="text-xs font-mono bg-border/30 text-text-muted px-2 py-1 rounded inline-block mb-2"
                                          x-text="displayColor('brand_color')"></code>
                                    <p class="text-text-muted text-xs m-0">Headers, navigation, primary elements</p>
                                </div>
                            </div>
                        </div>
                        {# Accent Color #}
                        <div class="bg-background border border-border rounded-xl p-5">
                            <div class="flex items-start gap-4">
                                <div class="relative group">
                                    <div class="w-20 h-20 rounded-xl border-2 border-border overflow-hidden shadow-sm group-hover:shadow-md transition-shadow cursor-pointer"
                                         :style="'background-color: ' + uiColors.accent_color">
                                        <input type="color"
                                               id="accent-color"
                                               class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                               x-model="uiColors.accent_color"
                                               :value="uiColors.accent_color"
                                               @input="updateColor('accent_color', $event.target.value)">
                                    </div>
                                    <input type="hidden"
                                           name="accent_color"
                                           :value="localBrandingInfo.accent_color || ''">
                                </div>
                                <div class="flex-1 pt-1">
                                    <label for="accent-color" class="text-sm font-semibold text-text block mb-2">Accent Color</label>
                                    <code class="text-xs font-mono bg-border/30 text-text-muted px-2 py-1 rounded inline-block mb-2"
                                          x-text="displayColor('accent_color')"></code>
                                    <p class="text-text-muted text-xs m-0">Buttons, links, highlights</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {# Visual Assets Section #}
            <div class="bg-background/50 border border-border rounded-xl p-5 mb-4"
                 @file-selected.window="handleFileFromComponent($event.detail.field,$event.detail.file)"
                 @file-removed.window="removeFile($event.detail.field)"
                 @existing-file-removed.window="handleExistingFileRemoval($event.detail.field)">
                <div class="flex items-start gap-3 mb-4">
                    <div class="w-8 h-8 rounded-lg bg-border/50 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-images text-text-muted text-sm"></i>
                    </div>
                    <div>
                        <h6 class="text-base font-semibold text-text m-0">Visual Assets</h6>
                        <p class="text-text-muted text-sm m-0">Upload your brand assets for public content</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 ml-11">
                    <div>
                        <label class="tw-form-label">Brand Icon</label>
                        {% include 'core/components/file-drag-and-drop.html.j2' with accept='image/*' existing_url=branding_info.icon_url field_name='icon' %}
                        <input type="hidden"
                               name="icon_pending_deletion"
                               :value="localBrandingInfo.icon_pending_deletion ? 'true' : 'false'">
                        <p class="tw-form-hint mt-2">Recommended: 512x512px PNG or SVG</p>
                    </div>
                    <div>
                        <label class="tw-form-label">Brand Logo</label>
                        {% include 'core/components/file-drag-and-drop.html.j2' with accept='image/*' existing_url=branding_info.logo_url field_name='logo' %}
                        <input type="hidden"
                               name="logo_pending_deletion"
                               :value="localBrandingInfo.logo_pending_deletion ? 'true' : 'false'">
                        <p class="tw-form-hint mt-2">Recommended: 1200x300px PNG or SVG</p>
                    </div>
                </div>
            </div>
            {# Display Preferences Section #}
            <div class="bg-background/50 border border-border rounded-xl p-5">
                <div class="flex items-start gap-3 mb-4">
                    <div class="w-8 h-8 rounded-lg bg-border/50 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-toggle-on text-text-muted text-sm"></i>
                    </div>
                    <div>
                        <h6 class="text-base font-semibold text-text m-0">Display Preferences</h6>
                        <p class="text-text-muted text-sm m-0">Toggle workspace branding on or off</p>
                    </div>
                </div>
                <div class="flex items-center justify-between flex-wrap gap-3 ml-11">
                    <p class="text-text-muted text-sm m-0">
                        Turn off to use the default sbomify visuals while keeping your custom assets saved.
                    </p>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox"
                               id="branding-enabled-toggle"
                               {% if branding_info.branding_enabled|default_if_none:False %}checked{% endif %}
                               class="tw-toggle"
                               x-model="localBrandingInfo.branding_enabled">
                    </label>
                    <input type="hidden"
                           name="branding_enabled"
                           :value="localBrandingInfo.branding_enabled ? 'true' : 'false'">
                </div>
            </div>
        </form>
    </div>
</div>
