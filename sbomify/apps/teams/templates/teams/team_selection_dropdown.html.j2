{% load teams %}
{% user_workspaces as available_workspaces %}
<div class="navbar-nav me-auto workspace-selector">
    <div class="nav-item dropdown d-flex align-items-center gap-3">
        <button class="nav-icon dropdown-toggle btn btn-link border-0 bg-transparent d-inline-block d-sm-none"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-haspopup="true"
                aria-label="Workspace menu (mobile)">
            <i class="align-middle fas fa-users"></i>
        </button>
        {% with current_view_name=request.resolver_match.namespaces.0|add:":"|add:request.resolver_match.url_name %}
            <button class="nav-link dropdown-toggle btn btn-link border-0 bg-transparent d-none d-sm-inline-flex align-items-center"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    aria-haspopup="true"
                    aria-label="Select workspace">
                <i class="fas fa-briefcase me-2" aria-hidden="true"></i>
                <span class="fw-medium">
                    {% if request.session.current_team %}
                        {{ request.session.current_team.name|workspace_display }}
                    {% else %}
                        Select Workspace
                    {% endif %}
                </span>
            </button>
            {% if request.session.current_team %}{% endif %}
            <ul class="dropdown-menu shadow-sm" role="menu">
                <li role="presentation">
                    <h6 class="dropdown-header" role="heading" aria-level="2">Switch Workspace</h6>
                </li>
                {% for t_key, t_info in available_workspaces.items %}
                    <li role="presentation">
                        <a class="dropdown-item {% if current_workspace_key == t_key %}active{% endif %}"
                           href="{% url 'teams:switch_team' t_key %}?next={{ current_view_name }}"
                           role="menuitem">
                            <i class="fas fa-folder me-2" aria-hidden="true"></i>
                            {{ t_info.name|workspace_display }}
                            {% if current_workspace_key == t_key %}
                                <i class="fas fa-check ms-auto text-success" aria-hidden="true"></i>
                                <span class="visually-hidden">(current workspace)</span>
                            {% endif %}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% endwith %}
    </div>
</div>
