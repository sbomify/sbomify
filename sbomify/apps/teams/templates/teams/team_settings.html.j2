{% extends "core/dashboard_base.htmx.j2" %}
{% load widget_tweaks %}
{% load django_vite %}
{% load static %}
{% load json_extras %}
{% load teams %}
{% block title %}sbomify Workspace Settings: {{ team.name|workspace_display }}{% endblock %}
{% block content %}
    <div class="page-header mb-4">
        <div class="header-main">
            <div class="title-section">
                <h1 class="item-title">
                    <i class="fas fa-cog mr-3 text-brand-primary"></i>
                    Workspace Settings
                </h1>
                <p class="item-subtitle">Manage {{ team.name }} configuration, members, and preferences</p>
            </div>
        </div>
    </div>
    <div class="settings-layout"
         x-cloak
         x-data="settingsTabs([ {% if request.session.current_team.role == 'owner' %}'general',{% endif %} 'members', 'tokens', {% if request.session.current_team.role == 'owner' %}'trust-center',{% endif %} {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %} 'contact-profiles', 'plugins', {% endif %} {% if request.session.current_team.role == 'owner' %}'integrations', 'billing',{% endif %} {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %} 'branding', {% endif %} ])"
         x-on:hashchange.window="handleHashChange()">
        <!-- Vertical Navigation Tabs -->
        <div class="settings-nav-col">
            <div class="settings-nav settings-nav-vertical">
                <nav class="flex flex-col settings-tabs">
                    {% if request.session.current_team.role == 'owner' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('general'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('general') }"
                           href="#general"
                           @click.prevent="handleTabClick($event, 'general')">
                            <i class="fas fa-sliders-h"></i>
                            <span>General</span>
                        </a>
                    {% endif %}
                    <a class="block px-4 py-2 rounded transition-colors"
                       :class="{ 'bg-brand-primary text-white': isActiveTab('members'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('members') }"
                       href="#members"
                       @click.prevent="handleTabClick($event, 'members')">
                        <i class="fas fa-users"></i>
                        <span>Members</span>
                    </a>
                    <a class="block px-4 py-2 rounded transition-colors"
                       :class="{ 'bg-brand-primary text-white': isActiveTab('tokens'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('tokens') }"
                       href="#tokens"
                       @click.prevent="handleTabClick($event, 'tokens')">
                        <i class="fas fa-key"></i>
                        <span>Tokens</span>
                    </a>
                    {% if request.session.current_team.role == 'owner' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('trust-center'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('trust-center') }"
                           href="#trust-center"
                           @click.prevent="handleTabClick($event, 'trust-center')">
                            <i class="fas fa-shield-alt"></i>
                            <span>Trust Center</span>
                        </a>
                    {% endif %}
                    {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('contact-profiles'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('contact-profiles') }"
                           href="#contact-profiles"
                           @click.prevent="handleTabClick($event, 'contact-profiles')">
                            <i class="fas fa-address-book"></i>
                            <span>Contact Profiles</span>
                        </a>
                    {% endif %}
                    {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('plugins'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('plugins') }"
                           href="#plugins"
                           @click.prevent="handleTabClick($event, 'plugins')">
                            <i class="fas fa-puzzle-piece"></i>
                            <span>Plugins</span>
                        </a>
                    {% endif %}
                    {% if request.session.current_team.role == 'owner' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('integrations'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('integrations') }"
                           href="#integrations"
                           @click.prevent="handleTabClick($event, 'integrations')">
                            <i class="fas fa-plug"></i>
                            <span>Integrations</span>
                        </a>
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('billing'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('billing') }"
                           href="#billing"
                           @click.prevent="handleTabClick($event, 'billing')">
                            <i class="fas fa-credit-card"></i>
                            <span>Billing</span>
                        </a>
                    {% endif %}
                    {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %}
                        <a class="block px-4 py-2 rounded transition-colors"
                           :class="{ 'bg-brand-primary text-white': isActiveTab('branding'), 'text-gray-700 hover:bg-gray-100': !isActiveTab('branding') }"
                           href="#branding"
                           @click.prevent="handleTabClick($event, 'branding')">
                            <i class="fas fa-palette"></i>
                            <span>Branding</span>
                        </a>
                    {% endif %}
                </nav>
            </div>
        </div>
        <!-- Tab Content -->
        <div class="settings-content-col">
            <div class="tab-content settings-content">
                {% if request.session.current_team.role == 'owner' %}
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('general') }"
                         id="general">{% include "teams/team_settings_tabs/general.html.j2" %}</div>
                {% endif %}
                <div class="tab-pane fade"
                     :class="{ 'show active': isActiveTab('members') }"
                     id="members">{% include "teams/team_settings_tabs/members.html.j2" %}</div>
                <div class="tab-pane fade"
                     :class="{ 'show active': isActiveTab('tokens') }"
                     id="tokens">{% include "teams/team_settings_tabs/tokens.html.j2" %}</div>
                {% if request.session.current_team.role == 'owner' %}
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('trust-center') }"
                         id="trust-center">{% include "teams/team_settings_tabs/trust_center.html.j2" %}</div>
                {% endif %}
                {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %}
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('contact-profiles') }"
                         id="contact-profiles">{% include "teams/team_settings_tabs/contact_profiles.html.j2" %}</div>
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('plugins') }"
                         id="plugins">{% include "teams/team_settings_tabs/plugins.html.j2" %}</div>
                {% endif %}
                {% if request.session.current_team.role == 'owner' %}
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('integrations') }"
                         id="integrations">{% include "teams/team_settings_tabs/integrations.html.j2" %}</div>
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('billing') }"
                         id="billing">{% include "teams/team_settings_tabs/billing.html.j2" %}</div>
                {% endif %}
                {% if request.session.current_team.role == 'owner' or request.session.current_team.role == 'admin' %}
                    <div class="tab-pane fade"
                         :class="{ 'show active': isActiveTab('branding') }"
                         id="branding">{% include "teams/team_settings_tabs/branding.html.j2" %}</div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    {% vite_asset 'sbomify/apps/core/js/main.ts' %}
    {% vite_asset 'sbomify/apps/teams/js/main.ts' %}
{% endblock %}
