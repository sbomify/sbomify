<div x-data="accountDangerZone({ csrfToken: '{{ csrf_token }}', tokenCount: {{ access_token_count }} })">
    <!-- Download My Data Section -->
    <div class="standard-card-container mb-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i class="fas fa-download me-2" aria-hidden="true"></i>
                    Download My Data
                </h4>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Export all your personal data as JSON (GDPR data portability).</p>
                <button class="btn btn-outline-secondary"
                        @click.prevent="exportData()"
                        :disabled="isExporting"
                        aria-label="Download your data">
                    <span x-show="isExporting" class="spinner-border spinner-border-sm me-2"></span>
                    <i x-show="!isExporting" class="fas fa-download me-2" aria-hidden="true"></i>
                    <span x-text="isExporting ? 'Exporting...' : 'Download My Data'"></span>
                </button>
            </div>
        </div>
    </div>
    <!-- Danger Zone Section -->
    <div class="standard-card-container">
        <div class="card dangerzone-card shadow-sm">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                    Danger Zone
                </h4>
            </div>
            <div class="card-body">
                <div class="danger-section delete-section">
                    <div class="section-header">
                        <div class="section-icon delete-icon">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <div class="section-content">
                            <h6 class="section-title">Delete Account</h6>
                            <p class="section-description">
                                Delete your sbomify account. Your account will be deactivated immediately and permanently removed after 14 days.
                            </p>
                        </div>
                    </div>
                    <button class="btn btn-danger modern-btn delete-btn"
                            @click.prevent="openDeleteModal()"
                            aria-label="Delete your account">
                        <i class="fas fa-user-slash me-2" aria-hidden="true"></i>
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Delete Account Modal -->
    <template x-teleport="body">
        <div x-show="showDeleteModal"
             x-cloak
             class="delete-modal-overlay"
             tabindex="-1"
             role="alertdialog"
             aria-modal="true"
             aria-labelledby="deleteAccountModalLabel"
             aria-describedby="deleteAccountModalDesc"
             @click.self="closeModal()"
             @keydown.escape="closeModal()">
            <div class="delete-modal" @click.stop>
                <div class="delete-modal-header">
                    <div class="delete-modal-icon">
                        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                    </div>
                    <h3 id="deleteAccountModalLabel" class="delete-modal-title">Delete Your Account</h3>
                    <button type="button"
                            class="delete-modal-close"
                            @click="closeModal()"
                            aria-label="Close">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="delete-modal-body">
                    <p id="deleteAccountModalDesc" class="delete-modal-message">
                        Your account will be deactivated immediately and permanently deleted after <strong>14 days</strong>.
                    </p>
                    <div class="alert alert-warning mb-3" x-show="tokenCount > 0" x-cloak>
                        <i class="fas fa-key me-2"></i>
                        You have <strong x-text="tokenCount"></strong> active API token(s) that will be <strong>immediately revoked</strong>. Any CI/CD pipelines using these tokens will stop working.
                    </div>
                    <div class="alert alert-info mb-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Immediate effects:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Account deactivated (cannot log in)</li>
                            <li>Personal access tokens revoked</li>
                            <li>Pending invitations removed</li>
                            <li>Workspaces where you are the sole member will be deleted</li>
                            <li>Stripe subscriptions for deleted workspaces will be cancelled</li>
                        </ul>
                    </div>
                    <div class="alert alert-secondary mb-3">
                        <i class="fas fa-clock me-2"></i>
                        <strong>After 14 days:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Account permanently deleted</li>
                            <li>Contact support to cancel deletion within the grace period</li>
                        </ul>
                    </div>
                    <!-- Validation Error Display -->
                    <div x-show="validationError"
                         x-cloak
                         class="alert alert-danger mt-3"
                         x-text="validationError"></div>
                    <label for="delete-account-confirm"
                           class="delete-modal-confirm-text mb-2 mt-3">
                        Type <strong>delete</strong> to confirm:
                    </label>
                    <input x-model="confirmText"
                           id="delete-account-confirm"
                           type="text"
                           class="form-control"
                           placeholder="Type 'delete' to confirm"
                           autocomplete="off"
                           :disabled="isDeleting"
                           @keydown.enter="if (canConfirm && !isDeleting) deleteAccount()" />
                </div>
                <div class="delete-modal-footer">
                    <button type="button"
                            class="delete-modal-button delete-modal-button--secondary"
                            @click="closeModal()"
                            :disabled="isDeleting">Cancel</button>
                    <button type="button"
                            class="delete-modal-button delete-modal-button--danger"
                            @click="deleteAccount()"
                            :disabled="!canConfirm || isDeleting">
                        <span x-show="isDeleting" class="spinner-border spinner-border-sm me-2"></span>
                        <i x-show="!isDeleting" class="fas fa-trash me-2"></i>
                        <span x-text="isDeleting ? 'Deleting...' : 'Delete My Account'"></span>
                    </button>
                </div>
            </div>
        </div>
    </template>
</div>
