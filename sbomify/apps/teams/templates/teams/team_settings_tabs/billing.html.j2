{% load static %}
<link rel="stylesheet"
      href="{% static 'css/components/team-billing.css' %}">
<div class="card shadow-md">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Billing Plan</h5>
        <div class="d-flex align-items-center gap-2">
            {% if team.billing_plan == 'community' or not team.billing_plan %}
                <span class="badge bg-secondary-subtle text-secondary">Community</span>
            {% elif team.billing_plan == 'business' %}
                <span class="badge bg-success-subtle text-success">Business</span>
            {% elif team.billing_plan == 'enterprise' %}
                <span class="badge bg-primary-subtle text-primary">Enterprise</span>
            {% endif %}
            {% if is_owner %}
                <a href="{% url 'billing:select_plan' team.key %}"
                   class="btn btn-sm btn-primary">
                    <i class="fas fa-credit-card me-2"></i>
                    {% if team.billing_plan == 'community' or not team.billing_plan %}
                        Upgrade Plan
                    {% else %}
                        Change Plan
                    {% endif %}
                </a>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <div class="billing-content">
            <div class="plan-info">
                <div class="plan-header">
                    <h5 class="plan-title">{{ team.billing_plan|default:'Community'|title }}</h5>
                    <div class="plan-price">
                        <span class="price-amount">{{ plan_pricing.amount|default:'$0' }}</span>
                        {% if plan_pricing.period %}<span class="price-period">{{ plan_pricing.period }}</span>{% endif %}
                        {% if plan_pricing.billing_period and team.billing_plan and team.billing_plan != 'community' %}
                            <span class="badge bg-info-subtle text-info ms-2">Billed
                                {% if plan_pricing.billing_period == 'annual' %}
                                    Annually
                                {% else %}
                                    {{ plan_pricing.billing_period|title }}
                                {% endif %}
                            </span>
                        {% endif %}
                        {% if team.billing_plan_limits.subscription_status == 'past_due' %}
                            <div class="next-billing-date mt-1 text-danger fw-bold small">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                Payment Failed
                                {% if team.billing_plan_limits.payment_failed_at %}
                                    <br>
                                    <span class="text-muted fw-normal">Check Dashboard for grace period status.</span>
                                {% endif %}
                            </div>
                        {% elif plan_pricing.next_billing_date %}
                            <div class="next-billing-date mt-1 text-muted small">
                                <i class="fas fa-calendar-alt me-1"></i>
                                {% if team.billing_plan_limits.cancel_at_period_end %}
                                    Plan Ends on: {{ plan_pricing.next_billing_date|date:"M d, Y" }}
                                {% else %}
                                    Next billing: {{ plan_pricing.next_billing_date|date:"M d, Y" }}
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% if team.billing_plan == 'community' or not team.billing_plan %}
                    <div class="plan-description">
                        <div class="free-plan-message">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span>You're currently on the Community tier. Upgrade to unlock additional features and higher limits.</span>
                        </div>
                    </div>
                {% endif %}
                {% if plan_limits %}
                    <div class="plan-limits">
                        <h6 class="limits-title">
                            {% if team.billing_plan == 'community' or not team.billing_plan %}
                                Current Limits
                            {% else %}
                                Plan Limits
                            {% endif %}
                        </h6>
                        <div class="limits-grid">
                            {% for limit in plan_limits %}
                                <div class="limit-item">
                                    <div class="limit-icon">
                                        <i class="fas fa-{{ limit.icon }}"></i>
                                    </div>
                                    <div class="limit-details">
                                        <span class="limit-label">{{ limit.label }}</span>
                                        <span class="limit-value">{{ limit.value }}</span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
                {% if plan_features %}
                    <div class="plan-features mt-4">
                        <h6 class="features-title mb-3">Plan Features</h6>
                        <ul class="list-unstyled row g-2 mb-0">
                            {% for feature in plan_features %}
                                <li class="col-6 feature-item">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {{ feature }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                {% if team.billing_plan == 'community' or not team.billing_plan %}
                    <div class="upgrade-cta">
                        <div class="cta-content">
                            <h6 class="cta-title">Ready to upgrade?</h6>
                            <p class="cta-description">Unlock advanced features, higher limits, and priority support.</p>
                            {% if is_owner %}
                                <a href="{% url 'billing:select_plan' team.key %}"
                                   class="btn btn-primary">
                                    <i class="fas fa-arrow-up me-2"></i>
                                    View Plans
                                </a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
