<div class="tw-card">
    <div class="px-6 py-4 border-b border-border flex justify-between items-center">
        <h5 class="text-lg font-semibold text-text m-0">Billing Plan</h5>
        <div class="flex items-center gap-3">
            {% if team.billing_plan == 'community' or not team.billing_plan %}
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-border/50 text-text-muted">Community</span>
            {% elif team.billing_plan == 'business' %}
                <span class="tw-badge-success">Business</span>
            {% elif team.billing_plan == 'enterprise' %}
                <span class="tw-badge-primary">Enterprise</span>
            {% endif %}
            {% if is_owner %}
                <a href="{% url 'billing:select_plan' team.key %}"
                   class="tw-btn-primary text-sm">
                    <i class="fas fa-credit-card mr-2"></i>
                    {% if team.billing_plan == 'community' or not team.billing_plan %}
                        Upgrade Plan
                    {% else %}
                        Change Plan
                    {% endif %}
                </a>
            {% endif %}
        </div>
    </div>
    <div class="p-6">
        <div class="space-y-6">
            <div>
                <div class="flex items-baseline gap-3 mb-2">
                    <h5 class="text-2xl font-bold text-text m-0">{{ team.billing_plan|default:'Community'|title }}</h5>
                    <div class="flex items-baseline gap-1">
                        <span class="text-3xl font-bold text-primary">{{ plan_pricing.amount|default:'$0' }}</span>
                        {% if plan_pricing.period %}<span class="text-text-muted">{{ plan_pricing.period }}</span>{% endif %}
                    </div>
                    {% if plan_pricing.billing_period and team.billing_plan and team.billing_plan != 'community' %}
                        <span class="tw-badge-info">Billed
                            {% if plan_pricing.billing_period == 'annual' %}
                                Annually
                            {% else %}
                                {{ plan_pricing.billing_period|title }}
                            {% endif %}
                        </span>
                    {% endif %}
                </div>
                {% if team.billing_plan_limits.subscription_status == 'past_due' %}
                    <div class="text-danger font-semibold text-sm flex items-center gap-1">
                        <i class="fas fa-exclamation-triangle"></i>
                        Payment Failed
                        {% if team.billing_plan_limits.payment_failed_at %}
                            <span class="text-text-muted font-normal ml-2">Check Dashboard for grace period status.</span>
                        {% endif %}
                    </div>
                {% elif plan_pricing.next_billing_date %}
                    <div class="text-text-muted text-sm flex items-center gap-1">
                        <i class="fas fa-calendar-alt"></i>
                        {% if team.billing_plan_limits.cancel_at_period_end %}
                            Plan Ends on: {{ plan_pricing.next_billing_date|date:"M d, Y" }}
                        {% else %}
                            Next billing: {{ plan_pricing.next_billing_date|date:"M d, Y" }}
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            {% if team.billing_plan == 'community' or not team.billing_plan %}
                <div class="flex items-start gap-3 p-4 bg-info/5 border border-info/20 rounded-lg">
                    <i class="fas fa-info-circle text-info mt-0.5"></i>
                    <span class="text-text">You're currently on the Community tier. Upgrade to unlock additional features and higher limits.</span>
                </div>
            {% endif %}
            {% if plan_limits %}
                <div>
                    <h6 class="text-sm font-semibold text-text mb-4">
                        {% if team.billing_plan == 'community' or not team.billing_plan %}
                            Current Limits
                        {% else %}
                            Plan Limits
                        {% endif %}
                    </h6>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {% for limit in plan_limits %}
                            <div class="flex items-center gap-3 p-3 bg-background/50 rounded-lg border border-border">
                                <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-{{ limit.icon }} text-primary"></i>
                                </div>
                                <div>
                                    <span class="block text-xs text-text-muted">{{ limit.label }}</span>
                                    <span class="block font-semibold text-text">{{ limit.value }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {% if plan_features %}
                <div>
                    <h6 class="text-sm font-semibold text-text mb-4">Plan Features</h6>
                    <div class="grid grid-cols-2 gap-2">
                        {% for feature in plan_features %}
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check text-success"></i>
                                <span class="text-text">{{ feature }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {% if team.billing_plan == 'community' or not team.billing_plan %}
                <div class="p-6 bg-gradient-to-r from-primary/5 to-primary/10 rounded-xl border border-primary/20">
                    <h6 class="text-lg font-semibold text-text mb-2">Ready to upgrade?</h6>
                    <p class="text-text-muted mb-4">Unlock advanced features, higher limits, and priority support.</p>
                    {% if is_owner %}
                        <a href="{% url 'billing:select_plan' team.key %}"
                           class="tw-btn-primary">
                            <i class="fas fa-arrow-up mr-2"></i>
                            View Plans
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
