"""Tests for VulnerabilityScansView._get_selected_days parameter validation."""

import pytest
from django.test import RequestFactory

from sbomify.apps.vulnerability_scanning.views_scans import VulnerabilityScansView


@pytest.mark.django_db
class TestGetSelectedDays:
    """Unit tests for the days query parameter parsing."""

    factory = RequestFactory()

    def _call(self, days: str | None = None) -> int | None:
        url = "/dummy/"
        if days is not None:
            url = f"/dummy/?days={days}"
        request = self.factory.get(url)
        return VulnerabilityScansView._get_selected_days(request)

    def test_default_is_30(self):
        assert self._call() == 30

    def test_empty_string_defaults_to_30(self):
        assert self._call("") == 30

    def test_all_returns_none(self):
        assert self._call("all") is None

    def test_valid_value(self):
        assert self._call("90") == 90

    def test_invalid_value_defaults_to_30(self):
        assert self._call("abc") == 30

    def test_lower_bound_clamped_to_1(self):
        assert self._call("-5") == 1
        assert self._call("0") == 1

    def test_upper_bound_clamped_to_365(self):
        assert self._call("9999") == 365
        assert self._call("366") == 365
        assert self._call("365") == 365

    def test_boundary_values(self):
        assert self._call("1") == 1
        assert self._call("364") == 364
