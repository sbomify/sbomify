{% load widget_tweaks %}
<div class="fixed inset-0 z-modal overflow-y-auto"
     id="{{ modal_id }}"
     tabindex="-1"
     aria-labelledby="{{ modal_id }}-label"
     aria-hidden="true"
     role="dialog"
     aria-modal="true"
     x-cloak
     x-data="formModal({{ autofocus|default:True|lower }})"
     x-show="open"
     x-trap.inert.noscroll="open"
     x-effect="open && handleShown()"
     @keydown.escape.window="open = false"
     style="display: none">
    <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity"
         x-show="open"
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="open = false"></div>
    <div class="flex min-h-full items-center justify-center p-4">
        <div class="relative mx-auto my-8 w-full max-w-lg transform overflow-hidden rounded-lg bg-white shadow-xl transition-all"
             x-show="open"
             x-transition:enter="ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave="ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             @click.stop>
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h4 class="text-lg font-semibold text-gray-700" id="{{ modal_id }}-label">
                    {% if icon %}<i class="fas {{ icon }} mr-2"></i>{% endif %}
                    {{ modal_title }}
                </h4>
                <button type="button"
                        class="text-gray-400 hover:text-gray-600 focus:outline-none"
                        @click="open = false"
                        aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <form action="{{ form_action }}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="_method" value="POST">
                    {% if additional_fields %}{{ additional_fields|safe }}{% endif %}
                    {% for field in form %}
                        <div class="mb-4">
                            <label for="{{ field.id_for_label }}"
                                   class="block text-sm font-medium text-gray-700 mb-1">
                                {{ field.label }}
                                {% if field.field.required %}<span class="text-danger-500">*</span>{% endif %}
                            </label>
                            {{ field|add_class:'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent' }}
                            {% if field.errors %}<div class="text-sm text-danger-500 mt-1">{{ field.errors|join:", " }}</div>{% endif %}
                            {% if field.help_text %}<div class="text-sm text-gray-600 mt-1">{{ field.help_text }}</div>{% endif %}
                        </div>
                    {% endfor %}
                    <div class="flex justify-end gap-2 mt-4">
                        <button type="button"
                                class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-50 transition-colors"
                                @click="open = false">Cancel</button>
                        <button type="submit"
                                class="px-4 py-2 bg-brand-primary text-white rounded hover:opacity-90 transition-opacity">
                            {% if icon %}<i class="fas {{ icon }} mr-2"></i>{% endif %}
                            {{ submit_text|default:"Submit" }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
