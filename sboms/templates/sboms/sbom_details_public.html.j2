{% extends "core/public_base.html.j2" %}
{% load widget_tweaks %}
{% load static %}
{% load django_vite %}
{% load breadcrumb_tags %}
{% block title %}{{ sbom.name }}{% endblock %}
{% block meta_description %}
    {{ sbom.name }} - SBOM (Software Bill of Materials) file.
    {% if sbom.format == 'cyclonedx' %}
        CycloneDX
    {% elif sbom.format == 'spdx' %}
        SPDX
    {% else %}
        {{ sbom.format|upper }}
    {% endif %}
    {{ sbom.format_version }} format. Download and view this SBOM.
{% endblock %}
{% block breadcrumb %}
    {% breadcrumb sbom.component 'component' %}
{% endblock %}
{% block content %}
    <!-- Public SBOM Details -->
    <div class="public-sbom-details">
        <!-- Header -->
        <div class="page-header mb-4">
            <div class="header-main">
                <div class="title-section">
                    <h1 class="item-title">
                        <i class="fas fa-file-code me-3 text-primary"></i>
                        {{ sbom.name }}
                    </h1>
                    <div class="meta-badges mt-2">
                        <span class="meta-badge meta-badge--primary">
                            <i class="fas fa-file-code"></i>
                            SBOM
                        </span>
                        <span class="meta-badge meta-badge--secondary">
                            <i class="fas fa-tag"></i>
                            {% if sbom.format == 'cyclonedx' %}
                                CycloneDX
                            {% elif sbom.format == 'spdx' %}
                                SPDX
                            {% else %}
                                {{ sbom.format|upper }}
                            {% endif %}
                            {{ sbom.format_version }}
                        </span>
                        {% if sbom.version %}
                            <span class="meta-badge meta-badge--secondary">
                                <i class="fas fa-code-branch"></i>
                                {{ sbom.version }}
                            </span>
                        {% endif %}
                        <span class="meta-badge meta-badge--secondary">
                            <i class="fas fa-cube"></i>
                            <a href="{% url 'core:component_details_public' sbom.component.id %}"
                               class="component-breadcrumb-link">{{ sbom.component.name }}</a>
                        </span>
                        {% if sbom.ntia_compliance_status == 'compliant' %}
                            {% include "sboms/components/ntia_compliance_badge.html.j2" with status=sbom.ntia_compliance_status compliance_details=sbom.ntia_compliance_details is_public_view=True team_billing_plan=team_billing_plan team_key=team.key sbom_id=sbom.id %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- SBOM Content -->
        <div class="sbom-content">
            <!-- SBOM Information -->
            <div class="public-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle me-2"></i>
                        SBOM Information
                    </h5>
                    <p class="card-subtitle text-muted mb-0">Details about this Software Bill of Materials</p>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Name:</dt>
                                <dd class="col-sm-8">
                                    {{ sbom.name }}
                                </dd>
                                <dt class="col-sm-4">Format:</dt>
                                <dd class="col-sm-8">
                                    <span class="badge bg-success-subtle text-success">
                                        {% if sbom.format == 'cyclonedx' %}
                                            CycloneDX
                                        {% elif sbom.format == 'spdx' %}
                                            SPDX
                                        {% else %}
                                            {{ sbom.format|upper }}
                                        {% endif %}
                                        {{ sbom.format_version }}
                                    </span>
                                </dd>
                                {% if sbom.version %}
                                    <dt class="col-sm-4">Version:</dt>
                                    <dd class="col-sm-8">
                                        {{ sbom.version }}
                                    </dd>
                                {% endif %}
                                <dt class="col-sm-4">Created:</dt>
                                <dd class="col-sm-8">
                                    {{ sbom.created_at|date:"F d, Y" }}
                                </dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <dl class="row">
                                <dt class="col-sm-4">Source:</dt>
                                <dd class="col-sm-8">
                                    {{ sbom.source_display }}
                                </dd>
                                {% if sbom.ntia_compliance_status %}
                                    <dt class="col-sm-4">NTIA Status:</dt>
                                    <dd class="col-sm-8">
                                        {% include "sboms/components/ntia_compliance_badge.html.j2" with status=sbom.ntia_compliance_status compliance_details=sbom.ntia_compliance_details is_public_view=True team_billing_plan=team_billing_plan team_key=team.key sbom_id=sbom.id %}
                                    </dd>
                                {% endif %}
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Download Section -->
            <div class="public-card mt-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-download me-2"></i>
                        Download SBOM
                    </h5>
                    <p class="card-subtitle text-muted mb-0">Get the complete SBOM file in its original format</p>
                </div>
                <div class="card-body text-center">
                    <a href="{% url 'sboms:sbom_download' sbom.id %}"
                       class="btn btn-primary btn-lg">
                        <i class="fas fa-download me-2"></i>
                        Download SBOM
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_css %}
    <style>
.component-breadcrumb-link {
    color: var(--accent-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

.component-breadcrumb-link:hover {
    color: var(--accent-color-dark);
    text-decoration: underline;
}

.component-link,
.sbom-format,
.sbom-version {
    margin-right: 1rem;
}

.sbom-version:last-child {
    margin-right: 0;
}

.version-display {
    display: inline-block;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: bottom;
}
    </style>
{% endblock %}
{% block scripts %}
    <!-- Minimal JS for copyable values -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copyable value functionality (if needed)
        document.querySelectorAll('.copyable-value').forEach(function(element) {
            element.style.cursor = 'pointer';
            element.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                navigator.clipboard.writeText(value).then(function() {
                    // Show success feedback
                    const originalText = element.textContent;
                    element.textContent = 'Copied!';
                    element.style.color = '#28a745';
                    setTimeout(function() {
                        element.textContent = originalText;
                        element.style.color = '';
                    }, 1000);
                });
            });
        });
    });
    </script>
{% endblock %}
