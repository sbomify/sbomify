{% extends "core/base.html.j2" %}
{% block title %}Add DT Server - {{ team.name }}{% endblock %}
{% block content %}
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <!-- Breadcrumb -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="{% url 'teams:teams_dashboard' %}">Workspaces</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="{% url 'teams:team_settings' team.key %}">{{ team.name }}</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="{% url 'teams:team_integrations' team.key %}">Integrations</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Add DT Server</li>
                    </ol>
                </nav>
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h3 mb-0">Add Dependency Track Server</h1>
                        <p class="text-muted mb-0">Configure a custom Dependency Track server for your Enterprise workspace</p>
                    </div>
                    <div>
                        <a href="{% url 'teams:team_integrations' team.key %}"
                           class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i>
                            Back to Integrations
                        </a>
                    </div>
                </div>
                <!-- Main Form Card -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="mt-3 mb-4">
                            <div class="card border-light shadow-brand">
                                <div class="card-header px-4 py-3">
                                    <h4 class="card-title mb-0">
                                        <i class="fas fa-server me-3 text-primary"></i>
                                        Server Configuration
                                    </h4>
                                </div>
                                <div class="card-body p-4">
                                    <form method="post">
                                        {% csrf_token %}
                                        <!-- Server Name -->
                                        <div class="mb-3">
                                            <label for="{{ form.name.id_for_label }}" class="form-label">
                                                {{ form.name.label }}
                                                <span class="text-danger">*</span>
                                            </label>
                                            {{ form.name }}
                                            {% if form.name.help_text %}<div class="form-text">{{ form.name.help_text }}</div>{% endif %}
                                            {% if form.name.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.name.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <!-- Server URL -->
                                        <div class="mb-3">
                                            <label for="{{ form.url.id_for_label }}" class="form-label">
                                                {{ form.url.label }}
                                                <span class="text-danger">*</span>
                                            </label>
                                            {{ form.url }}
                                            {% if form.url.help_text %}<div class="form-text">{{ form.url.help_text }}</div>{% endif %}
                                            {% if form.url.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.url.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <!-- API Key -->
                                        <div class="mb-3">
                                            <label for="{{ form.api_key.id_for_label }}" class="form-label">
                                                {{ form.api_key.label }}
                                                <span class="text-danger">*</span>
                                            </label>
                                            {{ form.api_key }}
                                            {% if form.api_key.help_text %}<div class="form-text">{{ form.api_key.help_text }}</div>{% endif %}
                                            {% if form.api_key.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.api_key.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <!-- Advanced Settings -->
                                        <div class="row">
                                            <div class="col-md-6">
                                                <!-- Priority -->
                                                <div class="mb-3">
                                                    <label for="{{ form.priority.id_for_label }}" class="form-label">
                                                        {{ form.priority.label }}
                                                        <span class="text-danger">*</span>
                                                    </label>
                                                    {{ form.priority }}
                                                    {% if form.priority.help_text %}<div class="form-text">{{ form.priority.help_text }}</div>{% endif %}
                                                    {% if form.priority.errors %}
                                                        <div class="invalid-feedback d-block">
                                                            {% for error in form.priority.errors %}{{ error }}{% endfor %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <!-- Max Concurrent Scans -->
                                                <div class="mb-3">
                                                    <label for="{{ form.max_concurrent_scans.id_for_label }}" class="form-label">
                                                        {{ form.max_concurrent_scans.label }}
                                                        <span class="text-danger">*</span>
                                                    </label>
                                                    {{ form.max_concurrent_scans }}
                                                    {% if form.max_concurrent_scans.help_text %}
                                                        <div class="form-text">{{ form.max_concurrent_scans.help_text }}</div>
                                                    {% endif %}
                                                    {% if form.max_concurrent_scans.errors %}
                                                        <div class="invalid-feedback d-block">
                                                            {% for error in form.max_concurrent_scans.errors %}{{ error }}{% endfor %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Form Actions -->
                                        <div class="d-flex justify-content-end gap-2">
                                            <a href="{% url 'teams:team_integrations' team.key %}"
                                               class="btn btn-outline-secondary">Cancel</a>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-plus me-1"></i>
                                                Create Server
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Help Info -->
                    <div class="col-lg-4">
                        <div class="mt-3 mb-4">
                            <div class="card border-light shadow-brand">
                                <div class="card-header px-4 py-3">
                                    <h4 class="card-title mb-0">
                                        <i class="fas fa-info-circle me-3 text-info"></i>
                                        Server Configuration Help
                                    </h4>
                                </div>
                                <div class="card-body p-4">
                                    <div class="mb-3">
                                        <h6 class="fw-semibold">Server Name</h6>
                                        <p class="small text-muted mb-0">
                                            Choose a descriptive name that identifies this server's purpose or environment (e.g., "Production DT", "Development Server").
                                        </p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="fw-semibold">Server URL</h6>
                                        <p class="small text-muted mb-0">
                                            The complete base URL of your Dependency Track server. Make sure it's accessible from sbomify's servers.
                                        </p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="fw-semibold">API Key</h6>
                                        <p class="small text-muted mb-2">
                                            Generate an API key in your Dependency Track server with the following permissions:
                                        </p>
                                        <div class="bg-dark rounded p-3 mb-2">
                                            <div class="small text-light font-monospace">
                                                <div class="text-warning fw-bold mb-2">Required Permissions:</div>
                                                <div class="mb-1">• BOM_UPLOAD</div>
                                                <div class="mb-1">• VIEW_PORTFOLIO</div>
                                                <div class="mb-1">• VIEW_VULNERABILITY</div>
                                                <div>• PROJECT_CREATION_UPLOAD</div>
                                            </div>
                                        </div>
                                        <p class="small text-muted mb-0">
                                            These permissions allow sbomify to upload SBOMs, create projects, and read vulnerability data from your Dependency Track server.
                                        </p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="fw-semibold">Priority</h6>
                                        <p class="small text-muted mb-0">
                                            Lower numbers get higher priority for load balancing. Set to 1 for highest priority.
                                        </p>
                                    </div>
                                    <div class="mb-0">
                                        <h6 class="fw-semibold">Max Concurrent Scans</h6>
                                        <p class="small text-muted mb-0">Limit the number of concurrent SBOM uploads to prevent overwhelming your server.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
